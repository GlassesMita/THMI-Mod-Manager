@page
@model DebugModel
@inject THMI_Mod_Manager.Services.AppConfigManager AppConfig
@inject THMI_Mod_Manager.Services.LocalizationManager LocalizationManager
@{
    ViewData["Title"] = "Debug";
    var themeColor = AppConfig.Get("[App]ThemeColor", "#c670ff");
}

<script>
    var localizedStrings = {
        checking: '@AppConfig.GetLocalized("Debug:Checking", "Checking...")',
        notSupported: '@AppConfig.GetLocalized("Debug:NotSupported", "Not Supported")',
        supported: '@AppConfig.GetLocalized("Debug:Supported", "Supported")',
        notAvailable: '@AppConfig.GetLocalized("Debug:NotAvailable", "N/A")',
        permissionGranted: '@AppConfig.GetLocalized("Debug:PermissionGranted", "Granted")',
        permissionDenied: '@AppConfig.GetLocalized("Debug:PermissionDenied", "Denied")',
        permissionDefault: '@AppConfig.GetLocalized("Debug:PermissionDefault", "Default")',
        notificationNotSupported: '@AppConfig.GetLocalized("Debug:NotificationNotSupported", "Notifications are not supported in this browser")',
        permissionGrantedMessage: '@AppConfig.GetLocalized("Debug:PermissionGrantedMessage", "Notification permission granted successfully")',
        permissionDeniedMessage: '@AppConfig.GetLocalized("Debug:PermissionDeniedMessage", "Notification permission denied")',
        permissionDefaultMessage: '@AppConfig.GetLocalized("Debug:PermissionDefaultMessage", "Notification permission is in default state")',
        permissionRequestError: '@AppConfig.GetLocalized("Debug:PermissionRequestError", "Error requesting notification permission")',
        permissionNotGranted: '@AppConfig.GetLocalized("Debug:PermissionNotGranted", "Notification permission is not granted. Please request permission first.")',
        notificationSent: '@AppConfig.GetLocalized("Debug:NotificationSent", "Notification sent successfully")',
        notificationSendError: '@AppConfig.GetLocalized("Debug:NotificationSendError", "Error sending notification")',
        defaultNotificationTitle: '@AppConfig.GetLocalized("Debug:DefaultNotificationTitle", "Test Notification")',
        defaultNotificationBody: '@AppConfig.GetLocalized("Debug:DefaultNotificationBody", "This is a test notification from THMI Mod Manager")'
    };
</script>

<link rel="stylesheet" href="~/css/settings.css" />

<style>
    .debug-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .debug-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .debug-section h3 {
        color: @themeColor;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid @themeColor;
    }
    
    .debug-info {
        background: #f8f9fa;
        border-left: 4px solid @themeColor;
        padding: 15px;
        margin-bottom: 15px;
    }
    
    .debug-info code {
        background: #e9ecef;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
    }
    
    .debug-toggle {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .debug-toggle input[type="checkbox"] {
        margin-right: 10px;
        width: 20px;
        height: 20px;
    }
    
    .debug-toggle label {
        margin: 0;
        cursor: pointer;
    }
    
    .debug-button-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    
    .debug-button {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .debug-button-primary {
        background: @themeColor;
        color: white;
    }
    
    .debug-button-primary:hover {
        opacity: 0.9;
    }
    
    .debug-button-secondary {
        background: #6c757d;
        color: white;
    }
    
    .debug-button-secondary:hover {
        background: #5a6268;
    }
    
    .debug-button-danger {
        background: #dc3545;
        color: white;
    }
    
    .debug-button-danger:hover {
        background: #c82333;
    }
    
    .debug-output {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 15px;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        margin-top: 15px;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    
    .debug-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    
    .debug-table th,
    .debug-table td {
        border: 1px solid #dee2e6;
        padding: 8px;
        text-align: left;
    }
    
    .debug-table th {
        background: #f8f9fa;
        font-weight: 600;
    }
    
    .debug-table tr:hover {
        background: #f8f9fa;
    }
    
    .debug-status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .debug-status-success {
        background: #d4edda;
        color: #155724;
    }
    
    .debug-status-warning {
        background: #fff3cd;
        color: #856404;
    }
    
    .debug-status-error {
        background: #f8d7da;
        color: #721c24;
    }
    
    .debug-status-info {
        background: #d1ecf1;
        color: #0c5460;
    }
</style>

<div class="debug-container">
    <h1 class="mods-title" id="debugHeader" style="cursor: default;">@AppConfig.GetLocalized("Debug:Header", "Debug Panel")</h1>
    <p class="text-muted">@AppConfig.GetLocalized("Debug:Subtitle", "Web Based App Debug Settings & Tools")</p>
    
    <!-- ÈöêËóèÁöÑÊÅ∂Ëá≠Êï∞Â≠óËÆ∫ËØÅÂô®ÔºåÁÇπÂáªÊ†áÈ¢ò5Ê¨°ÂêéÊòæÁ§∫ -->
    <!-- ÂéüÂßã Github Âú∞ÂùÄÔºöhttps://github.com/itorr/homo -->
    <div id="homoSection" style="display: none; margin-bottom: 20px;">
        <div class="debug-section">
            <h3><i data-icon="icon-calculator"></i> ÊÅ∂Ëá≠Êï∞Â≠óËÆ∫ËØÅÂô®</h3>
            <div style="text-align: center; padding: 20px;">
                <input type="number" id="homoInput" placeholder="ËæìÂÖ•‰ªªÊÑèÊï∞Â≠ó" style="font-size: 20px; line-height: 26px; text-align: center; padding: 8px 12px; border: 1px solid #dee2e6; border-radius: 4px; width: 80%; max-width: 300px;" />
                <div id="homoOutput" style="font-size: 24px; font-family: 'Comic Sans MS', cursive; padding: 40px 10px 100px;"></div>
            </div>
        </div>
    </div>
    
    <div class="debug-section">
        <h3><i data-icon="icon-info"></i> @AppConfig.GetLocalized("Debug:SystemInformation", "System Information")</h3>
        <div class="debug-info">
            <p><strong>@AppConfig.GetLocalized("Debug:Application", "Application"):</strong> @Model.AppName v@Model.AppVersion</p>
            <p><strong>@AppConfig.GetLocalized("Debug:Runtime", ".NET ÁâàÊú¨"):</strong> @Model.RuntimeVersion</p>
            <p><strong>@AppConfig.GetLocalized("Debug:OS", "OS"):</strong> @Model.OSProductName (@Model.OSFriendlyName)</p>
            <p><strong>@AppConfig.GetLocalized("Debug:BaseDirectory", "Base Directory"):</strong> <code>@Model.BaseDirectory</code></p>
            <p><strong>@AppConfig.GetLocalized("Debug:CurrentTime", "Current Time"):</strong> <span id="currentTime">@Model.CurrentTime</span></p>
        </div>
    </div>
    
    <div class="debug-section">
        <h3><i data-icon="icon-gear"></i> @AppConfig.GetLocalized("Debug:DeveloperMode", "Developer Mode")</h3>
        <div class="debug-toggle">
            <input type="checkbox" id="devMode" @(Model.IsDevMode ? "checked" : "") onchange="toggleDevMode(this)" />
            <label for="devMode">@AppConfig.GetLocalized("Debug:EnableDeveloperMode", "Enable Developer Mode")</label>
        </div>
        <div class="debug-toggle">
            <input type="checkbox" id="showCVEWarning" @(Model.ShowCVEWarning ? "checked" : "") onchange="toggleCVEWarning(this)" />
            <label for="showCVEWarning">@AppConfig.GetLocalized("Debug:ShowCVEWarning", "Show CVE Warning")</label>
        </div>
        <div class="debug-toggle">
            <input type="checkbox" id="enableVerboseLogging" @(Model.EnableVerboseLogging ? "checked" : "") onchange="toggleVerboseLogging(this)" />
            <label for="enableVerboseLogging">@AppConfig.GetLocalized("Debug:EnableVerboseLogging", "Enable Verbose Logging")</label>
        </div>
        <div class="debug-toggle">
            <input type="checkbox" id="disableCache" @(Model.DisableCache ? "checked" : "") onchange="toggleDisableCache(this)" />
            <label for="disableCache">@AppConfig.GetLocalized("Debug:DisableCache", "Disable Browser Cache")</label>
        </div>
    </div>
    
    <div class="debug-section">
        <h3><i data-icon="icon-wifi"></i> @AppConfig.GetLocalized("Debug:NetworkStatus", "Network Status")</h3>
        <div class="debug-info">
            <p><strong>@AppConfig.GetLocalized("Debug:ConnectionStatus", "Connection Status"):</strong> <span id="connectionStatus" class="debug-status debug-status-info">@AppConfig.GetLocalized("Debug:Checking", "Checking...")</span></p>
            <p><strong>@AppConfig.GetLocalized("Debug:ActiveInterfaces", "Active Interfaces"):</strong> <span id="activeInterfaces">-</span></p>
            <p><strong>@AppConfig.GetLocalized("Debug:ProxyStatus", "Proxy Status"):</strong> <span id="proxyStatus">-</span></p>
        </div>
        
        <div class="mb-3">
            <label for="networkSimulation" class="form-label">@AppConfig.GetLocalized("Debug:NetworkSimulation", "Simulate Network Status")</label>
            <select id="networkSimulation" class="form-select" onchange="simulateNetworkStatus()">
                <option value="">@AppConfig.GetLocalized("Debug:NoSimulation", "No Simulation (Real Network)")</option>
                <option value="ethernet">@AppConfig.GetLocalized("Debug:SimulateEthernet", "Ethernet (Connected)")</option>
                <option value="wifi">@AppConfig.GetLocalized("Debug:SimulateWifi", "WiFi (Connected)")</option>
                <option value="wifi-weak">@AppConfig.GetLocalized("Debug:SimulateWifiWeak", "WiFi (Weak Signal)")</option>
                <option value="no-internet">@AppConfig.GetLocalized("Debug:SimulateNoInternet", "No Internet")</option>
                <option value="disconnected">@AppConfig.GetLocalized("Debug:SimulateDisconnected", "Disconnected")</option>
            </select>
        </div>
        
        <div class="debug-button-group">
            <button type="button" class="debug-button debug-button-primary" onclick="checkNetworkStatus()">
                <i data-icon="icon-reload"></i> @AppConfig.GetLocalized("Debug:CheckNetwork", "Check Network")
            </button>
            <button type="button" class="debug-button debug-button-secondary" onclick="restoreNetworkStatus()">
                <i data-icon="icon-back"></i> @AppConfig.GetLocalized("Debug:RestoreNetwork", "Restore Real Network")
            </button>
        </div>
        <div id="networkResults" class="debug-output" style="display: none;"></div>
    </div>
    
    <div class="debug-section">
        <h3><i data-icon="icon-bug"></i> @AppConfig.GetLocalized("Debug:APITesting", "API Testing")</h3>
        <div class="mb-3">
            <label for="apiEndpoint" class="form-label">@AppConfig.GetLocalized("Debug:APIEndpoint", "API Endpoint")</label>
            <input type="text" id="apiEndpoint" class="form-control" value="/api/launcher/status" placeholder="@AppConfig.GetLocalized("Debug:Endpoint", "Enter API endpoint")" />
        </div>
        <div class="mb-3">
            <label for="apiMethod" class="form-label">@AppConfig.GetLocalized("Debug:HTTPMethod", "HTTP Method")</label>
            <select id="apiMethod" class="form-select">
                <option value="GET">GET</option>
                <option value="POST">POST</option>
                <option value="PUT">PUT</option>
                <option value="DELETE">DELETE</option>
            </select>
        </div>
        <div class="debug-button-group">
            <button type="button" class="debug-button debug-button-primary" onclick="testAPI()">
                <i data-icon="icon-play"></i> @AppConfig.GetLocalized("Debug:TestAPI", "Test API")
            </button>
            <button type="button" class="debug-button debug-button-secondary" onclick="clearAPIOutput()">
                <i data-icon="icon-clear"></i> @AppConfig.GetLocalized("Debug:ClearOutput", "Clear Output")
            </button>
        </div>
        <div id="apiOutput" class="debug-output" style="display: none;"></div>
    </div>
    
    <div class="debug-section">
        <h3><i data-icon="icon-bell"></i> @AppConfig.GetLocalized("Debug:NotificationTesting", "Browser Notification Testing")</h3>
        <div class="debug-info">
            <p><strong>@AppConfig.GetLocalized("Debug:NotificationPermission", "Notification Permission"):</strong> <span id="notificationPermission">Checking...</span></p>
            <p><strong>@AppConfig.GetLocalized("Debug:NotificationSupport", "Notification Support"):</strong> <span id="notificationSupport">Checking...</span></p>
        </div>
        <div class="mb-3">
            <label for="notificationTitle" class="form-label">@AppConfig.GetLocalized("Debug:NotificationTitle", "Notification Title")</label>
            <input type="text" id="notificationTitle" class="form-control" value="Test Notification" placeholder="@AppConfig.GetLocalized("Debug:EnterNotificationTitle", "Enter notification title")" />
        </div>
        <div class="mb-3">
            <label for="notificationBody" class="form-label">@AppConfig.GetLocalized("Debug:NotificationBody", "Notification Body")</label>
            <input type="text" id="notificationBody" class="form-control" value="This is a test notification from THMI Mod Manager" placeholder="@AppConfig.GetLocalized("Debug:EnterNotificationBody", "Enter notification body")" />
        </div>
        <div class="debug-button-group">
            <button type="button" class="debug-button debug-button-primary" onclick="requestNotificationPermission()">
                <i data-icon="icon-permission"></i> @AppConfig.GetLocalized("Debug:RequestPermission", "Request Permission")
            </button>
            <button type="button" class="debug-button debug-button-primary" onclick="sendTestNotification()">
                <i data-icon="icon-bell"></i> @AppConfig.GetLocalized("Debug:SendNotification", "Send Test Notification")
            </button>
        </div>
        <div id="notificationOutput" class="debug-output" style="display: none;"></div>
    </div>
    
    <div class="debug-section">
        <h3><i data-icon="icon-config"></i> @AppConfig.GetLocalized("Debug:Configuration", "Configuration")</h3>
        <div class="debug-info">
            <p><strong>@AppConfig.GetLocalized("Debug:ConfigFile", "Config File"):</strong> <code>@Model.ConfigFilePath</code></p>
            <p><strong>@AppConfig.GetLocalized("Debug:LastModified", "Last Modified"):</strong> @Model.ConfigLastModified</p>
        </div>
        <div class="debug-button-group">
            <button type="button" class="debug-button debug-button-primary" onclick="reloadConfig()">
                <i data-icon="icon-reload"></i> @AppConfig.GetLocalized("Debug:ReloadConfig", "Reload Configuration")
            </button>
            <button type="button" class="debug-button debug-button-secondary" onclick="viewConfig()">
                <i data-icon="icon-view"></i> @AppConfig.GetLocalized("Debug:ViewConfig", "View Configuration")
            </button>
        </div>
        <div id="configOutput" class="debug-output" style="display: none;"></div>
        <textarea id="configEditor" class="config-editor" readonly style="display: none; width: 100%; height: 400px; background: #1e1e1e; color: #d4d4d4; border: none; padding: 15px; font-family: 'Courier New', monospace; font-size: 12px; resize: vertical;"></textarea>
    </div>
    
    <div class="debug-section">
        <h3><i data-icon="icon-logs"></i> @AppConfig.GetLocalized("Debug:Logs", "Logs")</h3>
        <div class="debug-info">
            <p><strong>@AppConfig.GetLocalized("Debug:LogFile", "Log File"):</strong> <code>@Model.LogFilePath</code></p>
            <p><strong>@AppConfig.GetLocalized("Debug:LogSize", "Log Size"):</strong> @Model.LogFileSize</p>
        </div>
        <div class="debug-button-group">
            <button type="button" class="debug-button debug-button-primary" onclick="viewLogs()">
                <i data-icon="icon-view-logs"></i> @AppConfig.GetLocalized("Debug:ViewLogs", "View Logs")
            </button>
            <button type="button" class="debug-button debug-button-secondary" onclick="downloadLogs()">
                <i data-icon="icon-download-logs"></i> @AppConfig.GetLocalized("Debug:DownloadLogs", "Download Logs")
            </button>
            <button type="button" class="debug-button debug-button-danger" onclick="clearLogs()">
                <i data-icon="icon-clear-logs"></i> @AppConfig.GetLocalized("Debug:ClearLogs", "Clear Logs")
            </button>
        </div>
        <div id="logOutput" class="debug-output" style="display: none;"></div>
    </div>
    

    <div class="debug-section">
        <h3><i data-icon="icon-warning"></i> @AppConfig.GetLocalized("Debug:DangerZone", "Danger Zone")</h3>
        <div class="debug-info" style="border-left-color: #dc3545;">
            <p><strong>@AppConfig.GetLocalized("Debug:Warning", "Warning"):</strong> @AppConfig.GetLocalized("Debug:DangerWarning", "These actions are irreversible and may cause data loss or application instability.")</p>
        </div>
        <div class="debug-button-group">
            <button type="button" class="debug-button debug-button-danger" onclick="resetAllSettings()">
                <i data-icon="icon-reset"></i> @AppConfig.GetLocalized("Debug:ResetAllSettings", "Reset All Settings")
            </button>
            <button type="button" class="debug-button debug-button-danger" onclick="clearBrowserStorage()">
                <i data-icon="icon-clear-storage"></i> @AppConfig.GetLocalized("Debug:ClearBrowserStorage", "Clear Browser Storage")
            </button>
        </div>
    </div>
    
    <!-- ÈöêËóèÁöÑÂÜÖÊ†∏ÊÅêÊÖåËß¶ÂèëÂô® -->
    <div id="kernelPanicSection" style="display: none; margin-top: 20px;">
        <div class="debug-section" style="border: 2px solid #dc3545;">
            <h3 style="color: #dc3545;"><i data-icon="icon-danger"></i> KERNEL PANIC TRIGGER</h3>
            <div class="debug-info" style="background: #1e1e1e; color: #ff6b6b; border-left-color: #dc3545;">
                <p><strong style="color: #ff6b6b;">‚ö†Ô∏è WARNING:</strong> This will trigger a simulated kernel panic with full error display.</p>
                <p>This is for <strong>testing purposes only</strong> and will display the Linux Kernel Panic ASCII art.</p>
            </div>
            <div class="debug-button-group">
                <button type="button" class="debug-button" style="background: #dc3545; color: white;" onclick="triggerKernelPanic()">
                    <i data-icon="icon-danger"></i> üöÄ TRIGGER KERNEL PANIC
                </button>
            </div>
            <div id="kernelPanicOutput" class="debug-output" style="display: none; background: #000; color: #0f0;"></div>
        </div>
    </div>
</div>

<script>
    // ÊÅ∂Ëá≠Êï∞Â≠óËÆ∫ËØÅÂô® - ÂéüÂßã Github Âú∞ÂùÄÔºöhttps://github.com/itorr/homo
    const homo = ((Nums) => {
        const numsReversed = Object.keys(Nums).map(x => +x).filter(x => x > 0)
        const getMinDiv = (num) => {
            for (let i = numsReversed.length; i >= 0; i--)
                if (num >= numsReversed[i])
                    return numsReversed[i]
        }
        const isDotRegex = /\.(\d+?)0{0,}$/
        const demolish = (num) => {
            if (typeof num !== "number")
                return ""

            if (num === Infinity || Number.isNaN(num))
                return `Ëøô‰πàÊÅ∂Ëá≠ÁöÑ${num}ÊúâÂøÖË¶ÅËÆ∫ËØÅÂêó`

            if (num < 0)
                return `(‚ë®)*(${demolish(num * -1)})`.replace(/\*\(1\)/g, "")

            if (!Number.isInteger(num)) {
                const n = num.toFixed(16).match(isDotRegex)[1].length
                return `(${demolish(num * Math.pow(10, n))})/(10)^(${n})`
            }

            if (Nums[num])
                return String(num)

            const div = getMinDiv(num)
            return (`${div}*(${demolish(Math.floor(num / div))})+` +
                `(${demolish(num % div)})`).replace(/\*\(1\)|\+\(0\)$/g, "")
        }
        const finisher = (expr) => {
            expr = expr.replace(/\d+|‚ë®/g, (n) => Nums[n]).replace("^", "**")
            while (expr.match(/[\*|\/]\([^\+\-\(\)]+\)/))
                expr = expr.replace(/([\*|\/])\(([^\+\-\(\)]+)\)/, (m, $1, $2) => $1 + $2)
            while (expr.match(/[\+|\-]\([^\(\)]+\)[\+|\-|\)]/))
                expr = expr.replace(/([\+|\-])\(([^\(\)]+)\)([\+|\-|\)])/, (m, $1, $2, $3) => $1 + $2 + $3)
            while (expr.match(/[\+|\-]\(([^\(\)]+)\)$/))
                expr = expr.replace(/([\+|\-])\(([^\(\)]+)\)$/, (m, $1, $2) => $1 + $2)
            if (expr.match(/^\([^\(\)]+?\)$/))
                expr = expr.replace(/^\(([^\(\)]+)\)$/, "$1")
            expr = expr.replace(/\+-/g,'-')
            return expr
        }
        return (num) => finisher(demolish(num))
    })({
        229028: "(114514+114514)",
        114514: "114514",
        58596: "114*514",
        49654: "11*4514",
        45804: "11451*4",
        23256: "114*51*4",
        22616: "11*4*514",
        19844: "11*451*4",
        16030: "1145*14",
        14515: "1+14514",
        14514: "1*14514",
        14513: "-1+14514",
        11455: "11451+4",
        11447: "11451-4",
        9028: "(1+1)*4514",
        8976: "11*4*51*4",
        7980: "114*5*14",
        7710: "(1+14)*514",
        7197: "1+14*514",
        7196: "1*14*514",
        7195: "-1+14*514",
        6930: "11*45*14",
        6682: "(1-14)*-514",
        6270: "114*(51+4)",
        5818: "114*51+4",
        5810: "114*51-4",
        5808: "(1+1451)*4",
        5805: "1+1451*4",
        5804: "1*1451*4",
        5803: "-1+1451*4",
        5800: "(1-1451)*-4",
        5725: "1145*(1+4)",
        5698: "11*(4+514)",
        5610: "-11*(4-514)",
        5358: "114*(51-4)",
        5005: "11*(451+4)",
        4965: "11*451+4",
        4957: "11*451-4",
        4917: "11*(451-4)",
        4584: "(1145+1)*4",
        4580: "1145*1*4",
        4576: "(1145-1)*4",
        4525: "11+4514",
        4516: "1+1+4514",
        4515: "1+1*4514",
        4514: "1-1+4514",
        4513: "-1*1+4514",
        4512: "-1-1+4514",
        4503: "-11+4514",
        4112: "(1+1)*4*514",
        3608: "(1+1)*451*4",
        3598: "(11-4)*514",
        3435: "-1145*(1-4)",
        3080: "11*4*5*14",
        3060: "(11+4)*51*4",
        2857: "1+14*51*4",
        2856: "1*14*51*4",
        2855: "-1+14*51*4",
        2850: "114*5*(1+4)",
        2736: "114*(5+1)*4",
        2652: "(1-14)*51*-4",
        2570: "1*(1+4)*514",
        2475: "11*45*(1+4)",
        2420: "11*4*(51+4)",
        2280: "114*5*1*4",
        2248: "11*4*51+4",
        2240: "11*4*51-4",
        2166: "114*(5+14)",
        2068: "11*4*(51-4)",
        2067: "11+4*514",
        2058: "1+1+4*514",
        2057: "1/1+4*514",
        2056: "1/1*4*514",
        2055: "-1/1+4*514",
        2054: "-1-1+4*514",
        2045: "-11+4*514",
        2044: "(1+145)*14",
        2031: "1+145*14",
        2030: "1*145*14",
        2029: "-1+145*14",
        2024: "11*(45+1)*4",
        2016: "-(1-145)*14",
        1980: "11*45*1*4",
        1936: "11*(45-1)*4",
        1848: "(11+451)*4",
        1824: "114*(5-1)*4",
        1815: "11+451*4",
        1808: "1*(1+451)*4",
        1806: "1+1+451*4",
        1805: "1+1*451*4",
        1804: "1-1+451*4",
        1803: "1*-1+451*4",
        1802: "-1-1+451*4",
        1800: "1*-(1-451)*4",
        1793: "-11+451*4",
        1760: "-(11-451)*4",
        1710: "114*-5*(1-4)",
        1666: "(114+5)*14",
        1632: "(1+1)*4*51*4",
        1542: "1*-(1-4)*514",
        1526: "(114-5)*14",
        1485: "11*-45*(1-4)",
        1456: "1+1451+4",
        1455: "1*1451+4",
        1454: "-1+1451+4",
        1448: "1+1451-4",
        1447: "1*1451-4",
        1446: "-1+1451-4",
        1428: "(11-4)*51*4",
        1386: "11*(4+5)*14",
        1260: "(1+1)*45*14",
        1159: "1145+14",
        1150: "1145+1+4",
        1149: "1145+1*4",
        1148: "1145-1+4",
        1142: "1145+1-4",
        1141: "1145-1*4",
        1140: "(1145-1)-4",
        1131: "1145-14",
        1100: "11*4*5*(1+4)",
        1056: "11*4*(5+1)*4",
        1050: "(11+4)*5*14",
        1036: "(1+1)*(4+514)",
        1026: "114*-(5-14)",
        1020: "1*(1+4)*51*4",
        981: "1+14*5*14",
        980: "1*14*5*14",
        979: "-1+14*5*14",
        910: "-(1-14)*5*14",
        906: "(1+1)*451+4",
        898: "(1+1)*451-4",
        894: "(1+1)*(451-4)",
        880: "11*4*5*1*4",
        836: "11*4*(5+14)",
        827: "11+4*51*4",
        825: "(11+4)*(51+4)",
        818: "1+1+4*51*4",
        817: "1*1+4*51*4",
        816: "1*1*4*51*4",
        815: "-1+1*4*51*4",
        814: "-1-1+4*51*4",
        805: "-11+4*51*4",
        784: "(11+45)*14",
        771: "1+14*(51+4)",
        770: "1*14*(51+4)",
        769: "(11+4)*51+4",
        761: "(1+14)*51-4",
        730: "(1+145)*(1+4)",
        726: "1+145*(1+4)",
        725: "1*145*(1+4)",
        724: "-1-145*-(1+4)",
        720: "(1-145)*-(1+4)",
        719: "1+14*51+4",
        718: "1*14*51+4",
        717: "-1-14*-51+4",
        715: "(1-14)*-(51+4)",
        711: "1+14*51-4",
        710: "1*14*51-4",
        709: "-1+14*51-4",
        705: "(1+14)*(51-4)",
        704: "11*4*(5-1)*4",
        688: "114*(5+1)+4",
        680: "114*(5+1)-4",
        667: "-(1-14)*51+4",
        660: "(114+51)*4",
        659: "1+14*(51-4)",
        658: "1*14*(51-4)",
        657: "-1+14*(51-4)",
        649: "11*(45+14)",
        644: "1*(1+45)*14",
        641: "11+45*14",
        632: "1+1+45*14",
        631: "1*1+45*14",
        630: "1*1*45*14",
        629: "1*-1+45*14",
        628: "114+514",
        619: "-11+45*14",
        616: "1*-(1-45)*14",
        612: "-1*(1-4)*51*4",
        611: "(1-14)*-(51-4)",
        609: "11*(4+51)+4",
        601: "11*(4+51)-4",
        595: "(114+5)*(1+4)",
        584: "114*5+14",
        581: "1+145*1*4",
        580: "1*145/1*4",
        579: "-1+145*1*4",
        576: "1*(145-1)*4",
        575: "114*5+1+4",
        574: "114*5/1+4",
        573: "114*5-1+4",
        567: "114*5+1-4",
        566: "114*5*1-4",
        565: "114*5-1-4",
        561: "11/4*51*4",
        560: "(1+1)*4*5*14",
        558: "11*4+514",
        556: "114*5-14",
        545: "(114-5)*(1+4)",
        529: "1+14+514",
        528: "1*14+514",
        527: "-1+14+514",
        522: "(1+1)*4+514",
        521: "11-4+514",
        520: "1+1+4+514",
        519: "1+1*4+514",
        518: "1-1+4+514",
        517: "-1+1*4+514",
        516: "-1-1+4+514",
        514: "(1-1)/4+514",
        513: "-11*(4-51)-4",
        512: "1+1-4+514",
        511: "1*1-4+514",
        510: "1-1-4+514",
        509: "11*45+14",
        508: "-1-1-4+514",
        507: "-11+4+514",
        506: "-(1+1)*4+514",
        502: "11*(45+1)-4",
        501: "1-14+514",
        500: "11*45+1+4",
        499: "11*45*1+4",
        498: "11*45-1+4",
        495: "11*(4+5)*(1+4)",
        492: "11*45+1-4",
        491: "11*45-1*4",
        490: "11*45-1-4",
        488: "11*(45-1)+4",
        481: "11*45-14",
        480: "11*(45-1)-4",
        476: "(114+5)/1*4",
        470: "-11*4+514",
        466: "11+451+4",
        460: "114*(5-1)+4",
        458: "11+451-4",
        457: "1+1+451+4",
        456: "1*1+451+4",
        455: "1-1+451+4",
        454: "-1+1*451+4",
        453: "-1-1+451+4",
        452: "114*(5-1)-4",
        450: "(1+1)*45*(1+4)",
        449: "1+1+451-4",
        448: "1+1*451-4",
        447: "1/1*451-4",
        446: "1*-1+451-4",
        445: "-1-1+451-4",
        444: "-11+451+4",
        440: "(1+1)*4*(51+4)",
        438: "(1+145)*-(1-4)",
        436: "-11+451-4",
        435: "-1*145*(1-4)",
        434: "-1-145*(1-4)",
        432: "(1-145)*(1-4)",
        412: "(1+1)*4*51+4",
        404: "(1+1)*4*51-4",
        400: "-114+514",
        396: "11*4*-(5-14)",
        385: "(11-4)*(51+4)",
        376: "(1+1)*4*(51-4)",
        375: "(1+14)*5*(1+4)",
        368: "(1+1)*(45+1)*4",
        363: "(1+1451)/4",
        361: "(11-4)*51+4",
        360: "(1+1)*45*1*4",
        357: "(114+5)*-(1-4)",
        353: "(11-4)*51-4",
        352: "(1+1)*(45-1)*4",
        351: "1+14*-5*-(1+4)",
        350: "1*(1+4)*5*14",
        349: "-1+14*5*(1+4)",
        341: "11*(45-14)",
        337: "1-14*-(5+1)*4",
        336: "1*14*(5+1)*4",
        335: "-1+14*(5+1)*4",
        329: "(11-4)*(51-4)",
        327: "-(114-5)*(1-4)",
        325: "-(1-14)*5*(1+4)",
        318: "114+51*4",
        312: "(1-14)*-(5+1)*4",
        300: "(11+4)*5/1*4",
        297: "-11*(4+5)*(1-4)",
        291: "11+4*5*14",
        286: "(1145-1)/4",
        285: "(11+4)*(5+14)",
        282: "1+1+4*5*14",
        281: "1+14*5/1*4",
        280: "1-1+4*5*14",
        279: "1*-1+4*5*14",
        278: "-1-1+4*5*14",
        275: "1*(1+4)*(51+4)",
        270: "(1+1)*45*-(1-4)",
        269: "-11+4*5*14",
        268: "11*4*(5+1)+4",
        267: "1+14*(5+14)",
        266: "1*14*(5+14)",
        265: "-1+14*(5+14)",
        260: "1*(14+51)*4",
        259: "1*(1+4)*51+4",
        257: "(1+1)/4*514",
        252: "(114-51)*4",
        251: "1*-(1+4)*-51-4",
        248: "11*4+51*4",
        247: "-(1-14)*(5+14)",
        240: "(11+4)*(5-1)*4",
        236: "11+45*(1+4)",
        235: "1*(1+4)*(51-4)",
        234: "11*4*5+14",
        231: "11+4*(51+4)",
        230: "1*(1+45)*(1+4)",
        229: "1145/(1+4)",
        227: "1+1+45*(1+4)",
        226: "1*1+45*(1+4)",
        225: "11*4*5+1+4",
        224: "11*4*5/1+4",
        223: "11*4*5-1+4",
        222: "1+1+4*(51+4)",
        221: "1/1+4*(51+4)",
        220: "1*1*(4+51)*4",
        219: "1+14+51*4",
        218: "1*14+51*4",
        217: "11*4*5+1-4",
        216: "11*4*5-1*4",
        215: "11*4*5-1-4",
        214: "-11+45*(1+4)",
        212: "(1+1)*4+51*4",
        211: "11-4+51*4",
        210: "1+1+4+51*4",
        209: "1+1*4*51+4",
        208: "1*1*4+51*4",
        207: "-1+1*4*51+4",
        206: "11*4*5-14",
        204: "(1-1)/4+51*4",
        202: "1+1-4+51*4",
        201: "1/1-4+51*4",
        200: "1/1*4*51-4",
        199: "1*-1+4*51-4",
        198: "-1-1+4*51-4",
        197: "-11+4+51*4",
        196: "-(1+1)*4+51*4",
        195: "(1-14)*5*(1-4)",
        192: "(1+1)*4*(5+1)*4",
        191: "1-14+51*4",
        190: "1*-14+51*4",
        189: "-11-4+51*4",
        188: "1-1-(4-51)*4",
        187: "1/-1+4*(51-4)",
        186: "1+1+(45+1)*4",
        185: "1-1*-(45+1)*4",
        184: "114+5*14",
        183: "-1+1*(45+1)*4",
        182: "1+1+45/1*4",
        181: "1+1*45*1*4",
        180: "1*1*45*1*4",
        179: "-1/1+45*1*4",
        178: "-1-1+45*1*4",
        177: "1+1*(45-1)*4",
        176: "1*1*(45-1)*4",
        175: "-1+1*(45-1)*4",
        174: "-1-1+(45-1)*4",
        172: "11*4*(5-1)-4",
        171: "114*(5+1)/4",
        170: "(11-45)*-(1+4)",
        169: "114+51+4",
        168: "(11+45)*-(1-4)",
        165: "11*-45/(1-4)",
        161: "114+51-4",
        160: "1+145+14",
        159: "1*145+14",
        158: "-1+145+14",
        157: "1*(1-4)*-51+4",
        154: "11*(4-5)*-14",
        152: "(1+1)*4*(5+14)",
        151: "1+145+1+4",
        150: "1+145*1+4",
        149: "1*145*1+4",
        148: "1*145-1+4",
        147: "-1+145-1+4",
        146: "11+45*-(1-4)",
        143: "1+145+1-4",
        142: "1+145*1-4",
        141: "1+145-1-4",
        140: "1*145-1-4",
        139: "-1+145-1-4",
        138: "-1*(1+45)*(1-4)",
        137: "1+1-45*(1-4)",
        136: "1*1-45*(1-4)",
        135: "-1/1*45*(1-4)",
        134: "114+5/1*4",
        133: "114+5+14",
        132: "1+145-14",
        131: "1*145-14",
        130: "-1+145-14",
        129: "114+5*-(1-4)",
        128: "1+1+(4+5)*14",
        127: "1-14*(5-14)",
        126: "1*(14-5)*14",
        125: "-1-14*(5-14)",
        124: "114+5+1+4",
        123: "114-5+14",
        122: "114+5-1+4",
        121: "11*(45-1)/4",
        120: "-(1+1)*4*5*(1-4)",
        118: "(1+1)*(45+14)",
        117: "(1-14)*(5-14)",
        116: "114+5+1-4",
        115: "114+5*1-4",
        114: "11*4+5*14",
        113: "114-5/1+4",
        112: "114-5-1+4",
        111: "11+4*5*(1+4)",
        110: "-(11-451)/4",
        107: "11-4*-(5+1)*4",
        106: "114-5+1-4",
        105: "114+5-14",
        104: "114-5-1-4",
        103: "11*(4+5)+1*4",
        102: "11*(4+5)-1+4",
        101: "1+1*4*5*(1+4)",
        100: "1*(1+4)*5*1*4",
        99: "11*4+51+4",
        98: "1+1+4*(5+1)*4",
        97: "1+1*4*(5+1)*4",
        96: "11*(4+5)+1-4",
        95: "114-5-14",
        94: "114-5/1*4",
        93: "(1+1)*45-1+4",
        92: "(1+1)*(45-1)+4",
        91: "11*4+51-4",
        90: "-114+51*4",
        89: "(1+14)*5+14",
        88: "1*14*(5+1)+4",
        87: "11+4*(5+14)",
        86: "(1+1)*45*1-4",
        85: "1+14+5*14",
        84: "1*14+5*14",
        83: "-1+14+5*14",
        82: "1+1+4*5/1*4",
        81: "1/1+4*5*1*4",
        80: "1-1+4*5*1*4",
        79: "1*-1+4*5/1*4",
        78: "(1+1)*4+5*14",
        77: "11-4+5*14",
        76: "1+1+4+5*14",
        75: "1+14*5*1+4",
        74: "1/1*4+5*14",
        73: "1*14*5-1+4",
        72: "-1-1+4+5*14",
        71: "(1+14)*5-1*4",
        70: "11+45+14",
        69: "1*14+51+4",
        68: "1+1-4+5*14",
        67: "1-1*4+5*14",
        66: "1*14*5-1*4",
        65: "1*14*5-1-4",
        64: "11*4+5*1*4",
        63: "11*4+5+14",
        62: "1+14+51-4",
        61: "1+1+45+14",
        60: "11+45*1+4",
        59: "114-51-4",
        58: "-1+1*45+14",
        57: "1+14*5-14",
        56: "1*14*5-14",
        55: "-1+14*5-14",
        54: "11-4+51-4",
        53: "11+45+1-4",
        52: "11+45/1-4",
        51: "11+45-1-4",
        50: "1+1*45/1+4",
        49: "1*1*45/1+4",
        48: "-11+45+14",
        47: "1/-1+45-1+4",
        46: "11*4+5+1-4",
        45: "11+4*5+14",
        44: "114-5*14",
        43: "1+1*45+1-4",
        42: "11+45-14",
        41: "1/1*45*1-4",
        40: "-11+4*51/4",
        39: "-11+45+1+4",
        38: "-11+45*1+4",
        37: "-11+45-1+4",
        36: "11+4*5+1+4",
        35: "11*4+5-14",
        34: "1-14+51-4",
        33: "1+1+45-14",
        32: "1*1+45-14",
        31: "1/1*45-14",
        30: "1*-1+45-14",
        29: "-11+45-1-4",
        28: "11+4*5+1-4",
        27: "11+4*5/1-4",
        26: "11-4+5+14",
        25: "11*4-5-14",
        24: "1+14-5+14",
        23: "1*14-5+14",
        22: "1*14+5-1+4",
        21: "-1-1+4+5+14",
        20: "-11+45-14",
        19: "1+1+4*5+1-4",
        18: "1+1+4*5*1-4",
        17: "11+4*5-14",
        16: "11-4-5+14",
        15: "1+14-5+1+4",
        14: "11+4-5/1+4",
        13: "1*14-5/1+4",
        12: "-11+4+5+14",
        11: "11*-4+51+4",
        10: "-11/4+51/4",
        9: "11-4+5+1-4",
        8: "11-4+5/1-4",
        7: "11-4+5-1-4",
        6: "1-14+5+14",
        5: "11-4*5+14",
        4: "-11-4+5+14",
        3: "11*-4+51-4",
        2: "-11+4-5+14",
        1: "11/(45-1)*4",
        0: "(1-1)*4514",
        "‚ë®": "11-4-5+1-4",
    });

    // Ê†áÈ¢òÁÇπÂáªËÆ°Êï∞Âô®
    let headerClickCount = 0;
    const debugHeader = document.getElementById('debugHeader');
    const homoSection = document.getElementById('homoSection');
    const homoInput = document.getElementById('homoInput');
    const homoOutput = document.getElementById('homoOutput');
    const kernelPanicSection = document.getElementById('kernelPanicSection');
    
    // ÂÜÖÊ†∏ÊÅêÊÖåËß¶ÂèëÂô®Â∫èÂàóÔºö‰∏ä‰∏ä‰∏ã‰∏ãÂ∑¶Âè≥Â∑¶Âè≥BA
    const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
    let konamiIndex = 0;
    
    if (debugHeader) {
        debugHeader.addEventListener('click', function() {
            headerClickCount++;
            if (headerClickCount >= 5) {
                homoSection.style.display = 'block';
                headerClickCount = 0;
            }
        });
    }
    
    if (homoInput && homoOutput) {
        homoInput.oninput = function() {
            const num = homoInput.value === '' ? '' : Number(homoInput.value);
            homoOutput.innerHTML = num + ' = <big>' + homo(num) + '</big>';
        };
        homoInput.oninput();
    }
    
    // Áßë‰πêÁæéÁßòÁ±çÊ£ÄÊµã
    document.addEventListener('keydown', function(e) {
        if (!kernelPanicSection) return;
        
        if (e.key === konamiCode[konamiIndex]) {
            konamiIndex++;
            if (konamiIndex === konamiCode.length) {
                kernelPanicSection.style.display = 'block';
                konamiIndex = 0;
                showToast('üëÄ You found the hidden Kernel Panic trigger!', 'warning');
            }
        } else {
            konamiIndex = 0;
        }
    });
    
    // Ëß¶ÂèëÂÜÖÊ†∏ÊÅêÊÖå
    async function triggerKernelPanic() {
        const output = document.getElementById('kernelPanicOutput');
        output.style.display = 'block';
        output.innerHTML = 'Triggering Kernel Panic...\n\n';
        
        try {
            const response = await fetch('/Debug?handler=TriggerKernelPanic', {
                method: 'POST'
            });
            
            if (response.ok) {
                const data = await response.json();
                output.innerHTML += data.message + '\n\n';
                output.innerHTML += 'Kernel Panic has been triggered on the server.\n';
                output.innerHTML += 'Check the console window for the full ASCII art display.';
                showToast('Kernel Panic triggered! Check console.', 'error');
            } else {
                output.innerHTML += 'Failed to trigger kernel panic.\n';
                showToast('Failed to trigger kernel panic', 'error');
            }
        } catch (error) {
            output.innerHTML += 'Error: ' + error.message + '\n';
            showToast('Error triggering kernel panic: ' + error.message, 'error');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        updateCurrentTime();
        
        setInterval(updateCurrentTime, 1000);
        
        setTimeout(updateCurrentTime, 0);
    });

    var localizedStrings = {
        checkingNetwork: '@AppConfig.GetLocalized("Debug:CheckingNetwork", "Checking network status...")',
        checking: '@AppConfig.GetLocalized("Debug:Checking", "Checking...")',
        connected: '@AppConfig.GetLocalized("Debug:Connected", "Connected")',
        disconnected: '@AppConfig.GetLocalized("Debug:Disconnected", "Disconnected")',
        proxyEnabled: '@AppConfig.GetLocalized("Debug:ProxyEnabled", "Enabled")',
        proxyDisabled: '@AppConfig.GetLocalized("Debug:ProxyDisabled", "Disabled")',
        pingResults: '@AppConfig.GetLocalized("Debug:PingResults", "Ping Results:")',
        success: '@AppConfig.GetLocalized("Debug:Success", "Success")',
        failed: '@AppConfig.GetLocalized("Debug:Failed", "Failed")',
        checkFailed: '@AppConfig.GetLocalized("Debug:CheckFailed", "Check failed: ")',
        checkError: '@AppConfig.GetLocalized("Debug:CheckError", "Error checking network status: ")',
        error: '@AppConfig.GetLocalized("Debug:Error", "Error")'
    };

    function updateCurrentTime() {
        const now = new Date();
        const timeString = now.getFullYear() + '-' +
            String(now.getMonth() + 1).padStart(2, '0') + '-' +
            String(now.getDate()).padStart(2, '0') + ' ' +
            String(now.getHours()).padStart(2, '0') + ':' +
            String(now.getMinutes()).padStart(2, '0') + ':' +
            String(now.getSeconds()).padStart(2, '0');
        const currentTimeElement = document.getElementById('currentTime');
        if (currentTimeElement) {
            currentTimeElement.textContent = timeString;
        }
    }



    async function toggleDevMode(checkbox) {
        try {
            const response = await fetch('/Debug?handler=ToggleDevMode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enabled: checkbox.checked })
            });
            
            if (response.ok) {
                showToast('Developer mode ' + (checkbox.checked ? 'enabled' : 'disabled'));
            } else {
                showToast('Failed to toggle developer mode', 'error');
                checkbox.checked = !checkbox.checked;
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error toggling developer mode', 'error');
            checkbox.checked = !checkbox.checked;
        }
    }

    async function toggleCVEWarning(checkbox) {
        try {
            const response = await fetch('/Debug?handler=ToggleCVEWarning', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enabled: checkbox.checked })
            });
            
            if (response.ok) {
                showToast('CVE warning ' + (checkbox.checked ? 'enabled' : 'disabled'));
            } else {
                showToast('Failed to toggle CVE warning', 'error');
                checkbox.checked = !checkbox.checked;
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error toggling CVE warning', 'error');
            checkbox.checked = !checkbox.checked;
        }
    }

    async function toggleVerboseLogging(checkbox) {
        try {
            const response = await fetch('/Debug?handler=ToggleVerboseLogging', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enabled: checkbox.checked })
            });
            
            if (response.ok) {
                showToast('Verbose logging ' + (checkbox.checked ? 'enabled' : 'disabled'));
            } else {
                showToast('Failed to toggle verbose logging', 'error');
                checkbox.checked = !checkbox.checked;
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error toggling verbose logging', 'error');
            checkbox.checked = !checkbox.checked;
        }
    }

    async function toggleDisableCache(checkbox) {
        try {
            const response = await fetch('/Debug?handler=ToggleDisableCache', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ enabled: checkbox.checked })
            });
            
            if (response.ok) {
                showToast('Cache ' + (checkbox.checked ? 'disabled' : 'enabled'));
            } else {
                showToast('Failed to toggle cache', 'error');
                checkbox.checked = !checkbox.checked;
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error toggling cache', 'error');
            checkbox.checked = !checkbox.checked;
        }
    }

    async function checkNetworkStatus() {
        const output = document.getElementById('networkResults');
        const connectionStatus = document.getElementById('connectionStatus');
        const activeInterfaces = document.getElementById('activeInterfaces');
        const proxyStatus = document.getElementById('proxyStatus');
        
        output.style.display = 'block';
        output.textContent = localizedStrings.checkingNetwork;
        connectionStatus.textContent = localizedStrings.checking;
        connectionStatus.className = 'debug-status debug-status-info';
        
        try {
            const response = await fetch('/Debug?handler=CheckNetworkStatus');
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const data = await response.json();
            
            if (data.success) {
                const networkInfo = data.data;
                
                if (networkInfo.IsConnected) {
                    connectionStatus.textContent = localizedStrings.connected;
                    connectionStatus.className = 'debug-status debug-status-success';
                } else {
                    connectionStatus.textContent = localizedStrings.disconnected;
                    connectionStatus.className = 'debug-status debug-status-error';
                }
                
                activeInterfaces.textContent = `${networkInfo.ActiveInterfaces} / ${networkInfo.TotalInterfaces}`;
                
                if (networkInfo.IsUsingProxy) {
                    proxyStatus.textContent = localizedStrings.proxyEnabled;
                    proxyStatus.className = 'debug-status debug-status-warning';
                } else {
                    proxyStatus.textContent = localizedStrings.proxyDisabled;
                    proxyStatus.className = 'debug-status debug-status-success';
                }
                
                let resultText = localizedStrings.pingResults + '\n\n';
                
                networkInfo.PingResults.forEach(ping => {
                    resultText += `${ping.Name} (${ping.Url}):\n`;
                    if (ping.IsSuccess) {
                        resultText += `  Status: ${localizedStrings.success}\n`;
                        resultText += `  Response Time: ${ping.ResponseTime} ms\n`;
                        resultText += `  Status Code: ${ping.StatusCode}\n`;
                    } else {
                        resultText += `  Status: ${localizedStrings.failed}\n`;
                        resultText += `  Error: ${ping.ErrorMessage}\n`;
                    }
                    resultText += '\n';
                });
                
                output.textContent = resultText;
            } else {
                const errorMsg = data.message || 'Unknown error';
                output.textContent = localizedStrings.checkFailed + errorMsg;
                connectionStatus.textContent = localizedStrings.error;
                connectionStatus.className = 'debug-status debug-status-error';
                activeInterfaces.textContent = '-';
                proxyStatus.textContent = '-';
            }
        } catch (error) {
            console.error('Network check error:', error);
            const errorMsg = error.message || 'Unknown error';
            output.textContent = localizedStrings.checkError + errorMsg;
            connectionStatus.textContent = localizedStrings.error;
            connectionStatus.className = 'debug-status debug-status-error';
            activeInterfaces.textContent = '-';
            proxyStatus.textContent = '-';
        }
    }

    function simulateNetworkStatus() {
        const simulationType = document.getElementById('networkSimulation').value;
        const output = document.getElementById('networkResults');
        const connectionStatus = document.getElementById('connectionStatus');
        const activeInterfaces = document.getElementById('activeInterfaces');
        const proxyStatus = document.getElementById('proxyStatus');
        
        output.style.display = 'block';
        
        if (!simulationType) {
            output.textContent = 'Simulation disabled. Using real network status.';
            connectionStatus.textContent = localizedStrings.checking;
            connectionStatus.className = 'debug-status debug-status-info';
            activeInterfaces.textContent = '-';
            proxyStatus.textContent = '-';
            return;
        }
        
        const simulatedData = getSimulatedNetworkData(simulationType);
        
        if (simulatedData.isConnected) {
            connectionStatus.textContent = localizedStrings.connected;
            connectionStatus.className = 'debug-status debug-status-success';
        } else {
            connectionStatus.textContent = localizedStrings.disconnected;
            connectionStatus.className = 'debug-status debug-status-error';
        }
        
        activeInterfaces.textContent = simulatedData.activeInterfaces;
        proxyStatus.textContent = localizedStrings.proxyDisabled;
        proxyStatus.className = 'debug-status debug-status-success';
        
        let resultText = 'Simulated Network Status:\n\n';
        resultText += `Type: ${simulatedData.type}\n`;
        resultText += `SSID: ${simulatedData.ssid || 'N/A'}\n`;
        resultText += `Signal Strength: ${simulatedData.signalStrength}%\n`;
        resultText += `Has Internet: ${simulatedData.hasInternet ? 'Yes' : 'No'}\n`;
        resultText += `Is Connected: ${simulatedData.isConnected ? 'Yes' : 'No'}\n`;
        
        output.textContent = resultText;
        
        updateHeaderNetworkStatus(simulatedData);
    }
    
    function getSimulatedNetworkData(type) {
        switch (type) {
            case 'ethernet':
                return {
                    type: 'Ethernet',
                    ssid: '',
                    signalStrength: 100,
                    hasInternet: true,
                    isConnected: true,
                    activeInterfaces: '1 / 5'
                };
            case 'wifi':
                return {
                    type: 'Wireless',
                    ssid: 'TestWiFi_Network',
                    signalStrength: 85,
                    hasInternet: true,
                    isConnected: true,
                    activeInterfaces: '2 / 5'
                };
            case 'wifi-weak':
                return {
                    type: 'Wireless',
                    ssid: 'TestWiFi_Network',
                    signalStrength: 25,
                    hasInternet: true,
                    isConnected: true,
                    activeInterfaces: '2 / 5'
                };
            case 'no-internet':
                return {
                    type: 'Wireless',
                    ssid: 'TestWiFi_Network',
                    signalStrength: 75,
                    hasInternet: false,
                    isConnected: true,
                    activeInterfaces: '2 / 5'
                };
            case 'disconnected':
                return {
                    type: 'Unknown',
                    ssid: '',
                    signalStrength: 0,
                    hasInternet: false,
                    isConnected: false,
                    activeInterfaces: '0 / 5'
                };
            default:
                return {
                    type: 'Unknown',
                    ssid: '',
                    signalStrength: 0,
                    hasInternet: false,
                    isConnected: false,
                    activeInterfaces: '0 / 5'
                };
        }
    }
    
    function updateHeaderNetworkStatus(data) {
        const iconElement = document.getElementById('networkStatusIcon');
        if (!iconElement) return;
        
        const NetworkStatusIcons = {
            ethernet: '&#xE839;',
            wifiStrong: '&#xE701;',
            wifiGood: '&#xE874;',
            wifiFair: '&#xE873;',
            wifiWeak: '&#xE872;',
            noInternet: '&#xF384;'
        };
        
        let iconHtml;
        if (!data.isConnected || !data.hasInternet) {
            iconHtml = NetworkStatusIcons.noInternet;
        } else if (data.hasEthernet) {
            iconHtml = NetworkStatusIcons.ethernet;
        } else if (data.wifiSignalStrength >= 80) {
            iconHtml = NetworkStatusIcons.wifiStrong;
        } else if (data.wifiSignalStrength >= 60) {
            iconHtml = NetworkStatusIcons.wifiGood;
        } else if (data.wifiSignalStrength >= 40) {
            iconHtml = NetworkStatusIcons.wifiFair;
        } else {
            iconHtml = NetworkStatusIcons.wifiWeak;
        }
        
        iconElement.innerHTML = iconHtml;
        
        let tooltipText = '';
        if (!data.isConnected || !data.hasInternet) {
            tooltipText = '\nNo Internet connection';
        } else {
            if (data.hasEthernet) {
                tooltipText = 'Ethernet';
                if (data.hasWifi && data.wifiSsid) {
                    tooltipText += ' / ' + data.wifiSsid;
                }
            } else if (data.hasWifi && data.wifiSsid) {
                tooltipText = data.wifiSsid;
            }
            tooltipText += '\nInternet access';
        }
        
        iconElement.setAttribute('data-tooltip-text', tooltipText);
        
        if (typeof CustomTooltip !== 'undefined' && CustomTooltip.updateTooltip) {
            CustomTooltip.updateTooltip(iconElement);
        }
    }
    
    function restoreNetworkStatus() {
        document.getElementById('networkSimulation').value = '';
        
        simulateNetworkStatus();
        
        showToast('Network status restored to real network');
        
        if (typeof NetworkStatus !== 'undefined' && NetworkStatus.forceUpdate) {
            NetworkStatus.forceUpdate();
        }
    }


    async function testAPI() {
        const endpoint = document.getElementById('apiEndpoint').value;
        const method = document.getElementById('apiMethod').value;
        const output = document.getElementById('apiOutput');
        
        output.style.display = 'block';
        output.textContent = 'Testing ' + method + ' ' + endpoint + '...\n';
        
        try {
            const startTime = performance.now();
            const response = await fetch(endpoint, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            });
            const endTime = performance.now();
            
            const data = await response.json();
            
            output.textContent += 'Status: ' + response.status + ' ' + response.statusText + '\n';
            output.textContent += 'Time: ' + Math.round(endTime - startTime) + ' ms\n';
            output.textContent += 'Response:\n' + JSON.stringify(data, null, 2);
        } catch (error) {
            output.textContent += 'Error: ' + error.message;
        }
    }

    function clearAPIOutput() {
        document.getElementById('apiOutput').style.display = 'none';
        document.getElementById('apiOutput').textContent = '';
    }

    async function reloadConfig() {
        try {
            const response = await fetch('/Debug?handler=ReloadConfig', {
                method: 'POST'
            });
            
            if (response.ok) {
                showToast('Configuration reloaded successfully');
            } else {
                showToast('Failed to reload configuration', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error reloading configuration', 'error');
        }
    }

    async function viewConfig() {
        const output = document.getElementById('configOutput');
        const editor = document.getElementById('configEditor');
        output.style.display = 'block';
        output.textContent = 'Loading configuration...\n';
        
        try {
            const response = await fetch('/Debug?handler=ViewConfigRaw');
            
            if (response.ok) {
                const text = await response.text();
                output.style.display = 'none';
                editor.style.display = 'block';
                editor.value = text;
            } else {
                const errorText = await response.text();
                output.textContent = 'Error: Failed to load configuration\nStatus: ' + response.status + '\nDetails: ' + errorText;
                editor.style.display = 'none';
            }
        } catch (error) {
            output.textContent = 'Error: ' + error.message;
            editor.style.display = 'none';
        }
    }

    async function viewLogs() {
        const output = document.getElementById('logOutput');
        output.style.display = 'block';
        output.textContent = 'Loading logs...\n';
        
        try {
            const response = await fetch('/Debug?handler=ViewLogs');
            
            if (response.ok) {
                const data = await response.json();
                output.textContent = data.logs || 'No logs available';
            } else {
                output.textContent = 'Error: Failed to load logs';
            }
        } catch (error) {
            output.textContent = 'Error: ' + error.message;
        }
    }

    function downloadLogs() {
        window.open('/Debug?handler=DownloadLogs', '_blank');
    }

    async function clearLogs() {
        if (!confirm('Are you sure you want to clear all logs? This action cannot be undone.')) {
            return;
        }
        
        try {
            const response = await fetch('/Debug?handler=ClearLogs', {
                method: 'POST'
            });
            
            if (response.ok) {
                showToast('Logs cleared successfully');
                document.getElementById('logOutput').textContent = '';
            } else {
                showToast('Failed to clear logs', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error clearing logs', 'error');
        }
    }

    async function resetAllSettings() {
        if (!confirm('Are you sure you want to reset all settings to default? This action cannot be undone.')) {
            return;
        }
        
        try {
            const response = await fetch('/Debug?handler=ResetAllSettings', {
                method: 'POST'
            });
            
            if (response.ok) {
                showToast('All settings reset to default');
                setTimeout(() => location.reload(), 1000);
            } else {
                showToast('Failed to reset settings', 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showToast('Error resetting settings', 'error');
        }
    }

    function clearBrowserStorage() {
        if (!confirm('Are you sure you want to clear all browser storage including cookies? This action cannot be undone.')) {
            return;
        }
        
        try {
            localStorage.clear();
            sessionStorage.clear();
            
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            showToast('Browser storage cleared successfully');
        } catch (error) {
            showToast('Error clearing browser storage: ' + error.message);
        }
    }

    function checkNotificationSupport() {
        const supportSpan = document.getElementById('notificationSupport');
        const permissionSpan = document.getElementById('notificationPermission');
        
        if (!('Notification' in window)) {
            supportSpan.textContent = localizedStrings.notSupported;
            supportSpan.className = 'debug-status debug-status-error';
            permissionSpan.textContent = localizedStrings.notAvailable;
            return false;
        }
        
        supportSpan.textContent = localizedStrings.supported;
        supportSpan.className = 'debug-status debug-status-success';
        
        const permission = Notification.permission;
        switch (permission) {
            case 'granted':
                permissionSpan.textContent = localizedStrings.permissionGranted;
                permissionSpan.className = 'debug-status debug-status-success';
                break;
            case 'denied':
                permissionSpan.textContent = localizedStrings.permissionDenied;
                permissionSpan.className = 'debug-status debug-status-error';
                break;
            case 'default':
                permissionSpan.textContent = localizedStrings.permissionDefault;
                permissionSpan.className = 'debug-status debug-status-warning';
                break;
            default:
                permissionSpan.textContent = permission;
                permissionSpan.className = 'debug-status debug-status-info';
        }
        
        return true;
    }

    async function requestNotificationPermission() {
        const outputDiv = document.getElementById('notificationOutput');
        
        if (!('Notification' in window)) {
            outputDiv.textContent = localizedStrings.notificationNotSupported;
            outputDiv.style.display = 'block';
            return;
        }
        
        try {
            const permission = await Notification.requestPermission();
            
            checkNotificationSupport();
            
            if (permission === 'granted') {
                outputDiv.textContent = localizedStrings.permissionGrantedMessage;
                outputDiv.style.color = '#155724';
            } else if (permission === 'denied') {
                outputDiv.textContent = localizedStrings.permissionDeniedMessage;
                outputDiv.style.color = '#721c24';
            } else {
                outputDiv.textContent = localizedStrings.permissionDefaultMessage;
                outputDiv.style.color = '#856404';
            }
            
            outputDiv.style.display = 'block';
        } catch (error) {
            console.error('Error requesting notification permission:', error);
            outputDiv.textContent = localizedStrings.permissionRequestError + ': ' + error.message;
            outputDiv.style.color = '#721c24';
            outputDiv.style.display = 'block';
        }
    }

    function sendTestNotification() {
        const outputDiv = document.getElementById('notificationOutput');
        const titleInput = document.getElementById('notificationTitle');
        const bodyInput = document.getElementById('notificationBody');
        
        const title = titleInput.value || localizedStrings.defaultNotificationTitle;
        const body = bodyInput.value || localizedStrings.defaultNotificationBody;
        
        if (!('Notification' in window)) {
            outputDiv.textContent = localizedStrings.notificationNotSupported;
            outputDiv.style.color = '#721c24';
            outputDiv.style.display = 'block';
            return;
        }
        
        if (Notification.permission !== 'granted') {
            outputDiv.textContent = localizedStrings.permissionNotGranted;
            outputDiv.style.color = '#856404';
            outputDiv.style.display = 'block';
            return;
        }
        
        try {
            const notification = new Notification(title, {
                body: body,
                icon: '/favicon.ico',
                tag: 'test-notification-' + Date.now()
            });
            
            outputDiv.textContent = localizedStrings.notificationSent + ': ' + title;
            outputDiv.style.color = '#155724';
            outputDiv.style.display = 'block';
            
            notification.onclick = function() {
                window.focus();
                notification.close();
            };
        } catch (error) {
            console.error('Error sending notification:', error);
            outputDiv.textContent = localizedStrings.notificationSendError + ': ' + error.message;
            outputDiv.style.color = '#721c24';
            outputDiv.style.display = 'block';
        }
    }

    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = 'debug-toast';
        toast.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            background: ${type === 'success' ? '#28a745' : '#dc3545'};
            color: white;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        `;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease-out';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    const style = document.createElement('style');
    style.textContent = `
        @@keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @@keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `;
    document.head.appendChild(style);

    document.addEventListener('DOMContentLoaded', function() {
        checkNotificationSupport();
    });
</script>
