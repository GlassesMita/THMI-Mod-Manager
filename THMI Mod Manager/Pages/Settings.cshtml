@page
@model SettingsModel
@inject THMI_Mod_Manager.Services.AppConfigManager AppConfig
@inject THMI_Mod_Manager.Services.LocalizationManager LocalizationManager
@using System.Drawing
@{    
    ViewData["Title"] = AppConfig.GetLocalized("Settings:Title", "Settings");
    var locales = LocalizationManager.GetAvailableLocales();
    var selected = AppConfig.Get("[Localization]Language", "en_US");
    var themeColor = AppConfig.Get("[App]ThemeColor", "#c670ff");
    var launchMode = AppConfig.Get("[Game]LaunchMode", "steam_launch");
    var launcherPath = AppConfig.Get("[Game]LauncherPath", "");
}

<div class="cdx-page-container">
    <header class="cdx-page-header">
        <h1 class="cdx-page-title" id="settingsTitle" style="cursor: pointer;">
            <i data-icon="icon-settings" class="cdx-icon cdx-icon--settings" style="font-size: 1.25em;"></i>
            @AppConfig.GetLocalized("Settings:Header", "Settings")
        </h1>
        <div id="clickCounter" class="click-counter"></div>
        <p class="cdx-page-subtitle">@AppConfig.GetLocalized("Settings:Subtitle", "Customize your experience")</p>
    </header>

    @Html.AntiForgeryToken()
    <input type="hidden" name="iconFont" id="iconFontHidden" value="@Model.IconFont" />
    
    <form id="SettingsForm" method="post">
    
        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-language" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionLanguage", "Language & Region")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <label for="languageSelect" class="cdx-label">@AppConfig.GetLocalized("Settings:SelectLanguageLabel", "Language")</label>
                    <select id="languageSelect" name="language" class="cdx-select">
                        @foreach (var loc in locales)
                        {
                            var fileName = loc.FileName;
                            <option value="@fileName" selected="@(fileName == selected ? "selected" : null)">@loc.FriendlyName</option>
                        }
                    </select>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-time" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionDateTime", "Date & Time")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="showSeconds" name="showSeconds" @(Model.ShowSeconds ? "checked" : "") onchange="saveDateTimeSettings()" />
                        <label for="showSeconds" class="cdx-label">@AppConfig.GetLocalized("Settings:ShowSeconds", "Show seconds in time display")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="use12Hour" name="use12Hour" @(Model.Use12Hour ? "checked" : "") onchange="saveDateTimeSettings()" />
                        <label for="use12Hour" class="cdx-label">@AppConfig.GetLocalized("Settings:Use12Hour", "Use 12-hour time format (AM/PM)")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <label for="dateFormat" class="cdx-label">@AppConfig.GetLocalized("Settings:DateFormatLabel", "Date Format")</label>
                    <select id="dateFormat" name="dateFormat" class="cdx-select" onchange="saveDateTimeSettings()">
                        <option value="yyyy-mm-dd" selected="@(Model.DateFormat == "yyyy-mm-dd")">@AppConfig.GetLocalized("Settings:DateFormatYMD", "YYYY-MM-DD")</option>
                        <option value="dd-mm-yyyy" selected="@(Model.DateFormat == "dd-mm-yyyy")">@AppConfig.GetLocalized("Settings:DateFormatDMY", "DD-MM-YYYY")</option>
                        <option value="mm-dd-yyyy" selected="@(Model.DateFormat == "mm-dd-yyyy")">@AppConfig.GetLocalized("Settings:DateFormatMDY", "MM-DD-YYYY")</option>
                        <option value="month-dd" selected="@(Model.DateFormat == "month-dd")">@AppConfig.GetLocalized("Settings:DateFormatMonthD", "Mon DD")</option>
                        <option value="dd-month" selected="@(Model.DateFormat == "dd-month")">@AppConfig.GetLocalized("Settings:DateFormatDM", "DD Mon")</option>
                    </select>
                </div>
                <div class="cdx-field">
                    <label for="dateSeparator" class="cdx-label">@AppConfig.GetLocalized("Settings:DateSeparatorLabel", "Date Separator")</label>
                    <select id="dateSeparator" name="dateSeparator" class="cdx-select" onchange="saveDateTimeSettings()">
                        <option value="-" selected="@(Model.DateSeparator == "-")">@AppConfig.GetLocalized("Settings:DateSeparatorDash", "- (Dash)")</option>
                        <option value="/" selected="@(Model.DateSeparator == "/")">@AppConfig.GetLocalized("Settings:DateSeparatorSlash", "/ (Slash)")</option>
                    </select>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-cursor" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionAppearance", "Appearance")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <label for="cursorType" class="cdx-label">@AppConfig.GetLocalized("Settings:CursorLabel", "Cursor")</label>
                    <select id="cursorType" name="cursorType" class="cdx-select">
                        <option value="default" selected=@(AppConfig.Get("[Cursor]CursorType", "default") == "default")>@AppConfig.GetLocalized("Settings:CursorDefault", "Default Cursor")</option>
                        <option value="mystia" selected=@(AppConfig.Get("[Cursor]CursorType", "default") == "mystia")>@AppConfig.GetLocalized("Settings:CursorMystia", "Mystia Cursor (CSS)")</option>
                        <option value="osu" selected=@(AppConfig.Get("[Cursor]CursorType", "default") == "osu")>@AppConfig.GetLocalized("Settings:CursorOsu", "osu Cursor (JS)")</option>
                    </select>
                </div>
                <div class="cdx-field">
                    <label for="iconFont" class="cdx-label">@AppConfig.GetLocalized("Settings:IconFontLabel", "Icon Font")</label>
                    <select id="iconFont" name="iconFont" class="cdx-select" onchange="updateIconFont(this.value)">
                        @if (AppConfig.Get("[Icon]Font", "mdl2") == "mdl2")
                        {
                            <option value="mdl2" selected>@AppConfig.GetLocalized("Settings:IconFontMDL2", "Segoe MDL2 Assets")</option>
                        }
                        else
                        {
                            <option value="mdl2">@AppConfig.GetLocalized("Settings:IconFontMDL2", "Segoe MDL2 Assets")</option>
                        }
                        @if (AppConfig.Get("[Icon]Font", "mdl2") == "fluent")
                        {
                            <option value="fluent" selected>@AppConfig.GetLocalized("Settings:IconFontFluent", "Segoe Fluent Icons")</option>
                        }
                        else
                        {
                            <option value="fluent">@AppConfig.GetLocalized("Settings:IconFontFluent", "Segoe Fluent Icons")</option>
                        }
                    </select>
                    <p class="cdx-help-text">@AppConfig.GetLocalized("Settings:IconFontHelp", "Select icon font to use for UI icons.")</p>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-launch" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionLaunch", "Launch Settings")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <label class="cdx-label">@AppConfig.GetLocalized("Settings:LaunchModeLabel", "Launch Mode")</label>
                    <div class="cdx-radio-group">
                        <div class="cdx-radio">
                            <input type="radio" id="launchModeSteam" name="launchMode" value="steam_launch" @(Model.LaunchMode == "steam_launch" ? "checked" : "") onclick="toggleLauncherPath(this)" />
                            <label for="launchModeSteam">@AppConfig.GetLocalized("Settings:LaunchModeSteam", "Steam Launch")</label>
                        </div>
                        <div class="cdx-radio">
                            <input type="radio" id="launchModeExternal" name="launchMode" value="external_program" @(Model.LaunchMode == "external_program" ? "checked" : "") onclick="toggleLauncherPath(this)" />
                            <label for="launchModeExternal">@AppConfig.GetLocalized("Settings:LaunchModeExternal", "External Program")</label>
                        </div>
                    </div>
                </div>
                <div class="cdx-field cdx-field--indented" id="launcherPathSection" style="display: @(Model.LaunchMode == "external_program" ? "block" : "none")">
                    <label for="launcherPath" class="cdx-label">@AppConfig.GetLocalized("Settings:LauncherPathLabel", "Program Path")</label>
                    <div class="cdx-input-button">
                        <input type="text" id="launcherPath" name="launcherPath" class="cdx-text-input" value="@Model.LauncherPath" />
                        <button type="button" class="cdx-button cdx-button--primary" id="browseLauncherPath" data-title="@AppConfig.GetLocalized("FileBrowser:SelectExecutable", "Select Executable")">@AppConfig.GetLocalized("Common:Browse", "Browse")</button>
                    </div>
                    <p class="cdx-help-text" id="launcherPathNote">@AppConfig.GetLocalized("Settings:LauncherPathNote", "Select the executable file to launch the game.")</p>
                    <p class="cdx-help-text cdx-help-text--error" id="launcherPathError"></p>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-updates" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionUpdates", "Updates")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="autoCheckUpdates" name="autoCheckUpdates" @(Model.AutoCheckUpdates ? "checked" : "") onclick="toggleUpdateFrequency(this)" />
                        <label for="autoCheckUpdates" class="cdx-label">@AppConfig.GetLocalized("Updates:AutoCheckUpdates", "Automatically check for updates")</label>
                    </div>
                </div>
                <div class="cdx-field cdx-field--indented" id="updateFrequencySection">
                    <label for="updateFrequency" class="cdx-label">@AppConfig.GetLocalized("Updates:UpdateFrequencyLabel", "Check Frequency")</label>
                    <select id="updateFrequency" name="updateFrequency" class="cdx-select">
                        <option value="startup" selected="@(Model.UpdateFrequency == "startup")">@AppConfig.GetLocalized("Updates:FrequencyStartup", "On Startup")</option>
                        <option value="weekly" selected="@(Model.UpdateFrequency == "weekly")">@AppConfig.GetLocalized("Updates:FrequencyWeekly", "Weekly")</option>
                        <option value="monthly" selected="@(Model.UpdateFrequency == "monthly")">@AppConfig.GetLocalized("Updates:FrequencyMonthly", "Monthly")</option>
                    </select>
                </div>
                <div class="cdx-info-box">
                    <span class="cdx-info-box__text">@string.Format(AppConfig.GetLocalized("Updates:CurrentVersionInfo", "Current version: {0} {1}"), Model.ModName, Model.ModVersion)</span>
                </div>
                <div class="cdx-field cdx-field--indented">
                    <div class="cdx-button-group">
                        <button type="button" class="cdx-button cdx-button--primary cdx-button--small" id="checkNowButton">
                            @AppConfig.GetLocalized("Updates:CheckNowButton", "Check Now")
                        </button>
                        <button type="button" class="cdx-button cdx-button--safe cdx-button--small" id="downloadUpdateButton" style="display: none;">
                            @AppConfig.GetLocalized("Updates:DownloadButton", "Download")
                        </button>
                        <button type="button" class="cdx-button cdx-button--progressive cdx-button--small" id="applyUpdateButton" style="display: none;">
                            @AppConfig.GetLocalized("Updates:ApplyUpdateButton", "Apply")
                        </button>
                    </div>
                </div>
                <div class="cdx-field cdx-field--indented">
                    <div id="updateStatus" style="display: none;">
                        <span class="cdx-progress-bar cdx-progress-bar--inline" style="width: 200px;">
                            <span class="cdx-progress-bar__bar" style="width: 100%;"></span>
                        </span>
                        <span style="margin-left: 8px;">@AppConfig.GetLocalized("Updates:CheckingForUpdates", "Checking for updates...")</span>
                    </div>
                    <div id="updateResult" style="display: none; margin-top: 12px;"></div>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-notifications" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionNotifications", "Notifications")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="enableNotifications" name="enableNotifications" @(Model.EnableNotifications ? "checked" : "") onclick="toggleNotificationPermission(this)" />
                        <label for="enableNotifications" class="cdx-label">@AppConfig.GetLocalized("Notifications:EnableNotifications", "Enable browser notifications")</label>
                    </div>
                </div>
                <div class="cdx-field cdx-field--indented">
                    <div class="cdx-info-box cdx-info-box--muted">
                        <span class="cdx-info-box__text">@AppConfig.GetLocalized("Notifications:Description", "Receive notifications for updates and events")</span>
                    </div>
                    <div class="cdx-status-indicator" id="permissionStatus">
                        <span class="cdx-status-indicator__text" id="permissionStatusText">@AppConfig.GetLocalized("Notifications:CheckingPermission", "Checking...")</span>
                    </div>
                    <button type="button" class="cdx-button cdx-button--primary cdx-button--small" id="requestPermissionButton">
                        @AppConfig.GetLocalized("Notifications:RequestPermission", "Request Permission")
                    </button>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-title" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionTitle", "Window Title")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="modifyTitle" name="modifyTitle" @(Model.ModifyTitle ? "checked" : "") />
                        <label for="modifyTitle" class="cdx-label">@AppConfig.GetLocalized("Settings:ModifyTitleDescription", "Add 'Modded' prefix to game window title")</label>
                    </div>
                </div>
            </div>
        </section>

        @Html.AntiForgeryToken()

    <!-- BepInEx Settings -->
    <section class="cdx-card">
        <header class="cdx-card-header">
            <h2 class="cdx-card-title">
                <span class="cdx-icon icon-plugins" style="font-family: 'Segoe Fluent Icons'; font-size: 1em;">&#xE90F;</span>
                <span class="bepinex-title" 
                      data-original-title="@AppConfig.GetLocalized("Settings:SectionBepInEx", "BepInEx Configuration")"
                      data-tooltip-title="@AppConfig.GetLocalized("Settings:SectionBepInEx", "BepInEx Configuration")"
                      data-tooltip-text="@AppConfig.GetLocalized("Settings:BepInExWarning", "此处的设置建议在指导下进行操作")">@AppConfig.GetLocalized("Settings:SectionBepInEx", "BepInEx Configuration")</span>
            </h2>
        </header>
        <div class="cdx-card-body bepinex-body">
            <!-- BepInEx Settings -->
             <div class="cdx-field">
                    <label class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExConfigPath", "Config Path")</label>
                    <div class="cdx-input-button">
                        <input type="text" id="bepInExConfigPath" name="bepInExConfigPath" class="cdx-text-input" value="@Model.BepInExConfigPath" />
                        <button type="button" class="cdx-button cdx-button--primary" id="browseBepInExConfig" data-title="@AppConfig.GetLocalized("FileBrowser:SelectConfigFile", "Select Config File")">@AppConfig.GetLocalized("Common:Browse", "Browse")</button>
                    </div>
                    <p class="cdx-help-text">@AppConfig.GetLocalized("Settings:BepInExConfigPathHelp", "Path to BepInEx.cfg configuration file")</p>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="enableAssemblyCache" name="enableAssemblyCache" @(Model.EnableAssemblyCache ? "checked" : "") />
                        <label for="enableAssemblyCache" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExEnableAssemblyCache", "Enable assembly metadata cache")</label>
                    </div>
                    <p class="cdx-help-text">@AppConfig.GetLocalized("Settings:BepInExEnableAssemblyCacheHelp", "Speed up discovery of plugins by caching type metadata")</p>
                </div>
                <div class="cdx-field">
                    <label for="detourProviderType" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExDetourProvider", "Detour Provider")</label>
                    <select id="detourProviderType" name="detourProviderType" class="cdx-select">
                        <option value="Default" selected="@(Model.DetourProviderType == "Default")">@AppConfig.GetLocalized("Settings:BepInExDetourProviderDefault", "Default")</option>
                        <option value="Dobby" selected="@(Model.DetourProviderType == "Dobby")">@AppConfig.GetLocalized("Settings:BepInExDetourProviderDobby", "Dobby")</option>
                        <option value="Funchook" selected="@(Model.DetourProviderType == "Funchook")">@AppConfig.GetLocalized("Settings:BepInExDetourProviderFunchook", "Funchook")</option>
                    </select>
                </div>
                <div class="cdx-field">
                    <label for="harmonyLogChannels" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExHarmonyLogChannels", "Harmony Log Channels")</label>
                    <input type="text" id="harmonyLogChannels" name="harmonyLogChannels" class="cdx-text-input" value="@Model.HarmonyLogChannels" placeholder="@AppConfig.GetLocalized("Settings:BepInExHarmonyLogChannelsPlaceholder", "e.g., Warn, Error")" />
                    <p class="cdx-help-text">@AppConfig.GetLocalized("Settings:BepInExHarmonyLogChannelsHelp", "Available: None, Info, IL, Warn, Error, Debug, All")</p>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="updateInteropAssemblies" name="updateInteropAssemblies" @(Model.UpdateInteropAssemblies ? "checked" : "") />
                        <label for="updateInteropAssemblies" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExUpdateInteropAssemblies", "Update IL2CPP Interop Assemblies")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <label for="unityBaseLibrariesSource" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExUnityBaseLibrariesSource", "Unity Base Libraries URL")</label>
                    <input type="text" id="unityBaseLibrariesSource" name="unityBaseLibrariesSource" class="cdx-text-input" value="@Model.UnityBaseLibrariesSource" />
                </div>
                <div class="cdx-field">
                    <label for="il2cppInteropAssembliesPath" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExIL2CPPInteropAssembliesPath", "IL2CPP Interop Assemblies Path")</label>
                    <input type="text" id="il2cppInteropAssembliesPath" name="il2cppInteropAssembliesPath" class="cdx-text-input" value="@Model.IL2CPPInteropAssembliesPath" />
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="preloadIL2CPPInteropAssemblies" name="preloadIL2CPPInteropAssemblies" @(Model.PreloadIL2CPPInteropAssemblies ? "checked" : "") />
                        <label for="preloadIL2CPPInteropAssemblies" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExPreloadIL2CPPInteropAssemblies", "Preload IL2CPP Interop Assemblies")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="unityLogListening" name="unityLogListening" @(Model.UnityLogListening ? "checked" : "") />
                        <label for="unityLogListening" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExUnityLogListening", "Enable Unity Log Listening")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="consoleEnabled" name="consoleEnabled" @(Model.ConsoleEnabled ? "checked" : "") />
                        <label for="consoleEnabled" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExConsoleEnabled", "Enable Console")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="consolePreventClose" name="consolePreventClose" @(Model.ConsolePreventClose ? "checked" : "") />
                        <label for="consolePreventClose" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExConsolePreventClose", "Prevent Console Close")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="consoleShiftJisEncoding" name="consoleShiftJisEncoding" @(Model.ConsoleShiftJisEncoding ? "checked" : "") />
                        <label for="consoleShiftJisEncoding" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExConsoleShiftJisEncoding", "Use Shift-JIS Encoding")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <label for="consoleStandardOutType" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExConsoleStandardOutType", "Standard Output Type")</label>
                    <select id="consoleStandardOutType" name="consoleStandardOutType" class="cdx-select">
                        <option value="Auto" selected="@(Model.ConsoleStandardOutType == "Auto")">@AppConfig.GetLocalized("Settings:BepInExConsoleStandardOutTypeAuto", "Auto")</option>
                        <option value="ConsoleOut" selected="@(Model.ConsoleStandardOutType == "ConsoleOut")">@AppConfig.GetLocalized("Settings:BepInExConsoleStandardOutTypeConsoleOut", "Console Out")</option>
                        <option value="StandardOut" selected="@(Model.ConsoleStandardOutType == "StandardOut")">@AppConfig.GetLocalized("Settings:BepInExConsoleStandardOutTypeStandardOut", "Standard Out")</option>
                    </select>
                </div>
                <div class="cdx-field">
                    <label for="consoleLogLevels" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExConsoleLogLevels", "Console Log Levels")</label>
                    <input type="text" id="consoleLogLevels" name="consoleLogLevels" class="cdx-text-input" value="@Model.ConsoleLogLevels" placeholder="@AppConfig.GetLocalized("Settings:BepInExLogLevelsPlaceholder", "e.g., Fatal, Error, Warning, Message, Info")" />
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="diskLogEnabled" name="diskLogEnabled" @(Model.DiskLogEnabled ? "checked" : "") />
                        <label for="diskLogEnabled" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExDiskLogEnabled", "Enable Disk Logging")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="diskLogAppend" name="diskLogAppend" @(Model.DiskLogAppend ? "checked" : "") />
                        <label for="diskLogAppend" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExDiskLogAppend", "Append to Log File")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <label for="diskLogLevels" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExDiskLogLevels", "Disk Log Levels")</label>
                    <input type="text" id="diskLogLevels" name="diskLogLevels" class="cdx-text-input" value="@Model.DiskLogLevels" placeholder="@AppConfig.GetLocalized("Settings:BepInExLogLevelsPlaceholder", "e.g., Fatal, Error, Warning, Message, Info")" />
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="diskLogInstantFlushing" name="diskLogInstantFlushing" @(Model.DiskLogInstantFlushing ? "checked" : "") />
                        <label for="diskLogInstantFlushing" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExDiskLogInstantFlushing", "Instant Log Flushing")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <label for="diskLogConcurrentFileLimit" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExDiskLogConcurrentFileLimit", "Concurrent Log File Limit")</label>
                    <input type="number" id="diskLogConcurrentFileLimit" name="diskLogConcurrentFileLimit" class="cdx-text-input" value="@Model.DiskLogConcurrentFileLimit" min="1" max="20" />
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="writeUnityLog" name="writeUnityLog" @(Model.WriteUnityLog ? "checked" : "") />
                        <label for="writeUnityLog" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExWriteUnityLog", "Write Unity Log to Disk")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <label for="harmonyBackend" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExHarmonyBackend", "Harmony Backend")</label>
                    <select id="harmonyBackend" name="harmonyBackend" class="cdx-select">
                        <option value="auto" selected="@(Model.HarmonyBackend == "auto")">@AppConfig.GetLocalized("Settings:BepInExHarmonyBackendAuto", "Auto")</option>
                        <option value="dynamicmethod" selected="@(Model.HarmonyBackend == "dynamicmethod")">@AppConfig.GetLocalized("Settings:BepInExHarmonyBackendDynamicMethod", "Dynamic Method")</option>
                        <option value="methodbuilder" selected="@(Model.HarmonyBackend == "methodbuilder")">@AppConfig.GetLocalized("Settings:BepInExHarmonyBackendMethodBuilder", "Method Builder")</option>
                        <option value="cecil" selected="@(Model.HarmonyBackend == "cecil")">@AppConfig.GetLocalized("Settings:BepInExHarmonyBackendCecil", "Cecil")</option>
                    </select>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="dumpAssemblies" name="dumpAssemblies" @(Model.DumpAssemblies ? "checked" : "") />
                        <label for="dumpAssemblies" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExDumpAssemblies", "Dump Patched Assemblies")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="loadDumpedAssemblies" name="loadDumpedAssemblies" @(Model.LoadDumpedAssemblies ? "checked" : "") />
                        <label for="loadDumpedAssemblies" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExLoadDumpedAssemblies", "Load Dumped Assemblies")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="breakBeforeLoadAssemblies" name="breakBeforeLoadAssemblies" @(Model.BreakBeforeLoadAssemblies ? "checked" : "") />
                        <label for="breakBeforeLoadAssemblies" class="cdx-label">@AppConfig.GetLocalized("Settings:BepInExBreakBeforeLoadAssemblies", "Break Before Load Assemblies")</label>
                    </div>
                </div>
                <div class="cdx-field" style="margin-top: 1rem;">
                    <button type="button" class="cdx-button cdx-button--primary" id="saveBepInExSettings" data-action="saveBepInEx">
                        <span style="font-family: 'Segoe Fluent Icons'; margin-right: 4px;">&#xE74E;</span>
                        @AppConfig.GetLocalized("Common:Save", "Save")
                    </button>
                    <button type="button" class="cdx-button cdx-button--secondary" id="resetBepInExSettings" data-action="resetBepInEx" style="margin-left: 0.5rem;">
                        <span style="font-family: 'Segoe Fluent Icons'; margin-right: 4px;">&#xE72C;</span>
                        @AppConfig.GetLocalized("Common:Reset", "Reset to Default")
                    </button>
                </div>
            </div>
        </section>

        </form>

        <style>
            .cdx-page-container .cdx-text-input {
                width: 100%;
                box-sizing: border-box;
            }
            .cdx-page-container .cdx-select {
                width: 100%;
                box-sizing: border-box;
            }
            .cdx-page-container .cdx-input-button {
                width: 100%;
                box-sizing: border-box;
            }
            .cdx-page-container .cdx-input-button .cdx-text-input {
                flex: 1;
                min-width: 0;
            }
        </style>

        <footer class="cdx-page-footer">
            <input type="hidden" id="showSecondsHidden" name="showSeconds" value="@Model.ShowSeconds.ToString().ToLower()" />
            <input type="hidden" id="use12HourHidden" name="use12Hour" value="@Model.Use12Hour.ToString().ToLower()" />
            <input type="hidden" id="dateFormatHidden" name="dateFormat" value="@Model.DateFormat" />
            <input type="hidden" id="launchModeHidden" value="@Model.LaunchMode" />
            <input type="hidden" id="localizedProhibitionText" value="@AppConfig.GetLocalized("Settings:ProhibitionText", "Cannot select the Mod Manager's own executable.")" />
            <input type="hidden" id="localizedUpdateAvailable" value="@AppConfig.GetLocalized("Updates:UpdateAvailable", "Update available: Version {0}")" />
            <input type="hidden" id="localizedNoReleaseNotes" value="@AppConfig.GetLocalized("Updates:NoReleaseNotes", "No release notes")" />
            <input type="hidden" id="localizedDownloadUpdate" value="@AppConfig.GetLocalized("Updates:DownloadUpdate", "Download")" />
            <input type="hidden" id="localizedNoUpdatesAvailable" value="@AppConfig.GetLocalized("Updates:NoUpdatesAvailable", "No updates available")" />
            <input type="hidden" id="localizedUpdateCheckingDisabled" value="@AppConfig.GetLocalized("Updates:UpdateCheckingDisabled", "Update checking is disabled")" />
            <input type="hidden" id="localizedUpdateCheckFailed" value="@AppConfig.GetLocalized("Updates:UpdateCheckFailed", "Update check failed")" />
            <input type="hidden" id="localizedNotificationNotSupported" value="@AppConfig.GetLocalized("Notifications:NotSupported", "Not supported")" />
            <input type="hidden" id="localizedNotificationPermissionGranted" value="@AppConfig.GetLocalized("Notifications:PermissionGranted", "Granted")" />
            <input type="hidden" id="localizedNotificationPermissionDenied" value="@AppConfig.GetLocalized("Notifications:PermissionDenied", "Denied")" />
            <input type="hidden" id="localizedNotificationPermissionDefault" value="@AppConfig.GetLocalized("Notifications:PermissionDefault", "Not granted")" />
            <input type="hidden" id="localizedNotificationRequestSuccess" value="@AppConfig.GetLocalized("Notifications:PermissionRequestSuccess", "Permission granted")" />
            <input type="hidden" id="localizedNotificationRequestDenied" value="@AppConfig.GetLocalized("Notifications:PermissionRequestDenied", "Permission denied")" />
            <input type="hidden" id="localizedNotificationRequestFailed" value="@AppConfig.GetLocalized("Notifications:PermissionRequestFailed", "Request failed")" />
            <input type="hidden" id="localizedNotificationBlockedMessage" value="@AppConfig.GetLocalized("Notifications:NotificationBlockedMessage", "Notification permission has been blocked by the browser.")" />
            <input type="hidden" id="localizedBepInExWarning" value="@AppConfig.GetLocalized("Settings:BepInExWarning", "此处的设置建议在指导下进行操作")" />
            <input type="hidden" id="localizedSave" value="@AppConfig.GetLocalized("Common:Save", "Save")" />
            <input type="hidden" id="localizedReset" value="@AppConfig.GetLocalized("Common:Reset", "Reset to Default")" />
            <input type="hidden" id="localizedSaving" value="@AppConfig.GetLocalized("Common:Saving", "Saving...")" />
            <input type="hidden" id="localizedResetConfirm" value="@AppConfig.GetLocalized("Settings:BepInExResetConfirm", "确定要将所有 BepInEx 设置恢复为默认值吗？注意：恢复默认值后，请点击保存按钮来应用更改。当前配置文件的内容将被覆盖。")" />
            <input type="hidden" id="localizedResetComplete" value="@AppConfig.GetLocalized("Settings:BepInExResetComplete", "已恢复默认值，请点击保存按钮来应用更改。")" />
            <input type="hidden" id="localizedExpand" value="@AppConfig.GetLocalized("Common:Expand", "Expand")" />
            <input type="hidden" id="localizedCollapse" value="@AppConfig.GetLocalized("Common:Collapse", "Collapse")" />
            
            <button type="button" class="cdx-button cdx-button--primary cdx-button--large" id="saveButton" data-action="saveAll">
                <span style="font-family: 'Segoe Fluent Icons'; margin-right: 4px;">&#xE74E;</span>
                @AppConfig.GetLocalized("Common:Save", "Save Changes")
            </button>
        </footer>
    </div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const settingsTitle = document.getElementById('settingsTitle');
        if (settingsTitle && window.contextMenu) {
            settingsTitle.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                window.contextMenu.setMenuItems([
                    { 
                        type: 'url',
                        icon: 'icon-pin',
                        iconOnly: true,
                        iconContent: '&#xEC7A;',
                        url: '/DebugPage'
                    }
                ]);
                window.contextMenu.show(e.clientX, e.clientY);
            });
        }
    });
</script>

