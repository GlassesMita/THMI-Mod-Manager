@page
@model SettingsModel
@inject THMI_Mod_Manager.Services.AppConfigManager AppConfig
@inject THMI_Mod_Manager.Services.LocalizationManager LocalizationManager
@using System.Drawing
@{    ViewData["Title"] = AppConfig.GetLocalized("Settings:Title", "Settings");
    var locales = LocalizationManager.GetAvailableLocales();
    var selected = AppConfig.Get("[Localization]Language", "en_US");
    var themeColor = AppConfig.Get("[App]ThemeColor", "#c670ff");
}

<link rel="stylesheet" href="~/css/settings.css" />



<div class="settings-container">
    <h1 class="mods-title" id="settingsTitle" style="cursor: default;">@AppConfig.GetLocalized("Settings:Header", "Settings")</h1>
    <div class="click-counter" id="clickCounter">点击次数: <span id="clickCount">0</span>/10</div>

    <form method="post" asp-page-handler="SaveLanguage" id="settingsForm">
        <div class="mb-3 form-group-animated">
            <label for="languageSelect" class="form-label clickable-label">@AppConfig.GetLocalized("Settings:SelectLanguageLabel", "Language")</label>
            <select id="languageSelect" name="language" class="form-select">
                @foreach (var loc in locales)
                {
                    var fileName = loc.FileName; // original filename e.g. en_US or en-US
                    <option value="@fileName" selected="@(fileName == selected ? "selected" : null)">@loc.FriendlyName</option>
                }
            </select>
        </div>
        <hr class="settings-hr" />
        <!--
        <div class="mb-3 form-group-animated">
            <label for="statusSelect" class="form-label clickable-label">@AppConfig.GetLocalized("Settings:GameStatusLabel", "Game Purchase Status")</label>
            <br />
            <select id="statusSelect" name="status" class="form-select">
                <option value="owned">@AppConfig.GetLocalized("Settings:Owned", "Owned")</option>
                <option value="not_owned">@AppConfig.GetLocalized("Settings:NotOwned", "Not Owned")</option>
            </select>
        </div>
        -->
        <!-- 指针选择器 -->
        <div class="mb-3 form-group-animated">
            <label for="cursorType" class="form-label clickable-label">@AppConfig.GetLocalized("Settings:CursorLabel", "Cursor")</label>
            <select id="cursorType" name="cursorType" class="form-select">
                <option value="default" selected=@(AppConfig.Get("[Cursor]CursorType", "default") == "default")>@AppConfig.GetLocalized("Settings:CursorDefault", "Default Cursor")</option>
                <option value="mystia" selected=@(AppConfig.Get("[Cursor]CursorType", "default") == "mystia")>@AppConfig.GetLocalized("Settings:CursorMystia", "Mystia Cursor (CSS)")</option>
                <option value="osu" selected=@(AppConfig.Get("[Cursor]CursorType", "default") == "osu")>@AppConfig.GetLocalized("Settings:CursorOsu", "osu Cursor (JS)")</option>
            </select>
        </div>

        @*
        <div class="mb-3 form-group-animated">
            <label for="modsPath" class="form-label clickable-label">@AppConfig.GetLocalized("Settings:ModsPathLabel", "Mods Folder")</label>
            <div class="input-group">
                <input type="text" id="modsPath" name="modsPath" class="form-control" value="@AppConfig.Get("[App]ModsPath", AppContext.BaseDirectory)" readonly />
                <button type="button" class="btn btn-primary" id="browseModsPath" data-title="@AppConfig.GetLocalized("FileBrowser:SelectModsFolder", "Select Mods Folder")" disabled>@AppConfig.GetLocalized("Common:Browse", "Browse")</button>
            </div>
        </div>

        <div class="mb-3 form-group-animated">
            <label for="gamePath" class="form-label clickable-label">@AppConfig.GetLocalized("Settings:GamePathLabel", "Game Folder")</label>
            <div class="input-group">
                <input type="text" id="gamePath" name="gamePath" class="form-control" value="@AppConfig.Get("[App]GamePath", "")" readonly />
                <button type="button" class="btn btn-primary" id="browseGamePath" data-title="@AppConfig.GetLocalized("FileBrowser:SelectGameFolder", "Select Game Folder")" disabled>@AppConfig.GetLocalized("Common:Browse", "Browse")</button>
            </div>
        </div>
        *@

        <div class="mb-3 form-group-animated">
            <label for="themeColor" class="form-label clickable-label">@AppConfig.GetLocalized("Settings:ThemeColorLabel", "Theme Color")</label>
            <div class="input-group">
                <input type="color" id="themeColor" name="themeColor" class="form-control form-control-color" value="@themeColor" title="Choose your theme color" />
                <input type="text" id="themeColorText" name="themeColorText" class="form-control" value="@themeColor" />
            </div>
        </div>

        <!--
        <div class="mb-3 form-group-animated">
            <label class="form-label clickable-label">@AppConfig.GetLocalized("Settings:SteamStatusLabel", "Steam Status")</label>
            <div class="checkbox-container">
                <input type="checkbox" id="isSteam" name="isSteam" @(bool.Parse(AppConfig.Get("[App]IsSteam", "true")) ? "checked" : "") />
                <label for="isSteam" class="checkbox-label">@AppConfig.GetLocalized("Settings:IsSteam", "Steam Version")</label>
            </div>
        </div>
        -->
        
        <div class="mb-3 form-group-animated">
            <label class="form-label clickable-label">@AppConfig.GetLocalized("Settings:GameVersionLabel", "Game Version")</label>
            <div class="cursor-radio-option">
                <input type="radio" id="gameVersionLegitimate" name="gameVersion" value="legitimate" @(AppConfig.Get("[App]GameVersion", "legitimate") == "legitimate" ? "checked" : "") onclick="toggleCustomLauncher(this)" />
                <label for="gameVersionLegitimate" class="cursor-radio-label">@AppConfig.GetLocalized("Settings:GameVersionLegitimate", "Legitimate (Steam)")</label>
            </div>
            <div class="cursor-radio-option">
                <input type="radio" id="gameVersionPirated" name="gameVersion" value="pirated" @(AppConfig.Get("[App]GameVersion", "legitimate") == "pirated" ? "checked" : "") onclick="toggleCustomLauncher(this)" />
                <label for="gameVersionPirated" class="cursor-radio-label">@AppConfig.GetLocalized("Settings:GameVersionPirated", "Pirated (Custom Launcher)")</label>
            </div>
        </div>

        <div class="custom-launcher-section" id="customLauncherSection">
            <div class="mb-3 form-group-animated">
                <label for="customLauncherPath" class="form-label clickable-label">@AppConfig.GetLocalized("Settings:CustomLauncherLabel", "Custom Launcher")</label>
                <div class="input-group">
                    <input type="text" id="customLauncherPath" name="customLauncherPath" class="form-control" value="@AppConfig.Get("[App]CustomLauncherPath", "")" />
                    <button type="button" class="btn btn-primary" id="browseCustomLauncher" data-title="@AppConfig.GetLocalized("FileBrowser:SelectExecutable", "Select Executable File")">@AppConfig.GetLocalized("Common:Browse", "Browse")</button>
                </div>
                <div id="customLauncherError" class="text-danger mt-1"></div>
                <small id="customLauncherNote" class="form-text text-muted">@AppConfig.GetLocalized("Settings:CustomLauncherNote", "Select the executable file to launch the game. The Mod Manager's own executable is not allowed.")</small>
            </div>
        </div>

        <button type="submit" class="btn btn-primary save-button" id="saveButton">
            <span id="saveText">@AppConfig.GetLocalized("Common:Save", "Save")</span>
            <div id="loadingSpinner" class="spinner-border spinner-border-sm" style="display: none;" role="status">
                <span class="visually-hidden">@AppConfig.GetLocalized("Common:Saving", "Saving...")</span>
            </div>
        </button>
    </form>

    <div class="success-toast" id="successToast">
        @AppConfig.GetLocalized("Settings:ChangesSaved", "Changes saved successfully!")
    </div>
</div>

<script src="~/js/settings.js"></script>

