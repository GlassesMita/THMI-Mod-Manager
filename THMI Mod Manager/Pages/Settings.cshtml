@page
@model SettingsModel
@inject THMI_Mod_Manager.Services.AppConfigManager AppConfig
@inject THMI_Mod_Manager.Services.LocalizationManager LocalizationManager
@using System.Drawing
@{    
    ViewData["Title"] = AppConfig.GetLocalized("Settings:Title", "Settings");
    var locales = LocalizationManager.GetAvailableLocales();
    var selected = AppConfig.Get("[Localization]Language", "en_US");
    var themeColor = AppConfig.Get("[App]ThemeColor", "#c670ff");
    var launchMode = AppConfig.Get("[Game]LaunchMode", "steam_launch");
    var launcherPath = AppConfig.Get("[Game]LauncherPath", "");
}

<div class="cdx-page-container">
    <header class="cdx-page-header">
        <h1 class="cdx-page-title">
            <i data-icon="icon-settings" class="cdx-icon cdx-icon--settings" style="font-size: 1.25em;"></i>
            @AppConfig.GetLocalized("Settings:Header", "Settings")
        </h1>
        <p class="cdx-page-subtitle">@AppConfig.GetLocalized("Settings:Subtitle", "Customize your experience")</p>
    </header>

    <form method="post" asp-page-handler="SaveLanguage" id="settingsForm">
        <input type="hidden" name="iconFont" id="iconFontHidden" value="@Model.IconFont" />
        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-language" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionLanguage", "Language & Region")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <label for="languageSelect" class="cdx-label">@AppConfig.GetLocalized("Settings:SelectLanguageLabel", "Language")</label>
                    <select id="languageSelect" name="language" class="cdx-select">
                        @foreach (var loc in locales)
                        {
                            var fileName = loc.FileName;
                            <option value="@fileName" selected="@(fileName == selected ? "selected" : null)">@loc.FriendlyName</option>
                        }
                    </select>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-time" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionDateTime", "Date & Time")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="showSeconds" name="showSeconds" @(Model.ShowSeconds ? "checked" : "") onchange="saveDateTimeSettings()" />
                        <label for="showSeconds" class="cdx-label">@AppConfig.GetLocalized("Settings:ShowSeconds", "Show seconds in time display")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="use12Hour" name="use12Hour" @(Model.Use12Hour ? "checked" : "") onchange="saveDateTimeSettings()" />
                        <label for="use12Hour" class="cdx-label">@AppConfig.GetLocalized("Settings:Use12Hour", "Use 12-hour time format (AM/PM)")</label>
                    </div>
                </div>
                <div class="cdx-field">
                    <label for="dateFormat" class="cdx-label">@AppConfig.GetLocalized("Settings:DateFormatLabel", "Date Format")</label>
                    <select id="dateFormat" name="dateFormat" class="cdx-select" onchange="saveDateTimeSettings()">
                        <option value="yyyy-mm-dd" selected="@(Model.DateFormat == "yyyy-mm-dd")">@AppConfig.GetLocalized("Settings:DateFormatYMD", "YYYY-MM-DD")</option>
                        <option value="dd-mm-yyyy" selected="@(Model.DateFormat == "dd-mm-yyyy")">@AppConfig.GetLocalized("Settings:DateFormatDMY", "DD-MM-YYYY")</option>
                        <option value="mm-dd-yyyy" selected="@(Model.DateFormat == "mm-dd-yyyy")">@AppConfig.GetLocalized("Settings:DateFormatMDY", "MM-DD-YYYY")</option>
                        <option value="month-dd" selected="@(Model.DateFormat == "month-dd")">@AppConfig.GetLocalized("Settings:DateFormatMonthD", "Mon DD")</option>
                        <option value="dd-month" selected="@(Model.DateFormat == "dd-month")">@AppConfig.GetLocalized("Settings:DateFormatDM", "DD Mon")</option>
                    </select>
                </div>
                <div class="cdx-field">
                    <label for="dateSeparator" class="cdx-label">@AppConfig.GetLocalized("Settings:DateSeparatorLabel", "Date Separator")</label>
                    <select id="dateSeparator" name="dateSeparator" class="cdx-select" onchange="saveDateTimeSettings()">
                        <option value="-" selected="@(Model.DateSeparator == "-")">@AppConfig.GetLocalized("Settings:DateSeparatorDash", "- (Dash)")</option>
                        <option value="/" selected="@(Model.DateSeparator == "/")">@AppConfig.GetLocalized("Settings:DateSeparatorSlash", "/ (Slash)")</option>
                    </select>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-cursor" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionAppearance", "Appearance")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <label for="cursorType" class="cdx-label">@AppConfig.GetLocalized("Settings:CursorLabel", "Cursor")</label>
                    <select id="cursorType" name="cursorType" class="cdx-select">
                        <option value="default" selected=@(AppConfig.Get("[Cursor]CursorType", "default") == "default")>@AppConfig.GetLocalized("Settings:CursorDefault", "Default Cursor")</option>
                        <option value="mystia" selected=@(AppConfig.Get("[Cursor]CursorType", "default") == "mystia")>@AppConfig.GetLocalized("Settings:CursorMystia", "Mystia Cursor (CSS)")</option>
                        <option value="osu" selected=@(AppConfig.Get("[Cursor]CursorType", "default") == "osu")>@AppConfig.GetLocalized("Settings:CursorOsu", "osu Cursor (JS)")</option>
                    </select>
                </div>
                <div class="cdx-field">
                    <label for="iconFont" class="cdx-label">@AppConfig.GetLocalized("Settings:IconFontLabel", "Icon Font")</label>
                    <select id="iconFont" name="iconFont" class="cdx-select" onchange="updateIconFont(this.value)">
                        <option value="mdl2" selected=@(AppConfig.Get("[Icon]Font", "mdl2") == "mdl2")>@AppConfig.GetLocalized("Settings:IconFontMDL2", "Segoe MDL2 Assets")</option>
                        <option value="fluent" selected=@(AppConfig.Get("[Icon]Font", "mdl2") == "fluent")>@AppConfig.GetLocalized("Settings:IconFontFluent", "Segoe Fluent Icons")</option>
                    </select>
                    <p class="cdx-help-text">@AppConfig.GetLocalized("Settings:IconFontHelp", "Select the icon font to use for UI icons.")</p>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-launch" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionLaunch", "Launch Settings")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <label class="cdx-label">@AppConfig.GetLocalized("Settings:LaunchModeLabel", "Launch Mode")</label>
                    <div class="cdx-radio-group">
                        <div class="cdx-radio">
                            <input type="radio" id="launchModeSteam" name="launchMode" value="steam_launch" @(Model.LaunchMode == "steam_launch" ? "checked" : "") onclick="toggleLauncherPath(this)" />
                            <label for="launchModeSteam">@AppConfig.GetLocalized("Settings:LaunchModeSteam", "Steam Launch")</label>
                        </div>
                        <div class="cdx-radio">
                            <input type="radio" id="launchModeExternal" name="launchMode" value="external_program" @(Model.LaunchMode == "external_program" ? "checked" : "") onclick="toggleLauncherPath(this)" />
                            <label for="launchModeExternal">@AppConfig.GetLocalized("Settings:LaunchModeExternal", "External Program")</label>
                        </div>
                    </div>
                </div>
                <div class="cdx-field cdx-field--indented" id="launcherPathSection" style="display: @(Model.LaunchMode == "external_program" ? "block" : "none")">
                    <label for="launcherPath" class="cdx-label">@AppConfig.GetLocalized("Settings:LauncherPathLabel", "Program Path")</label>
                    <div class="cdx-input-button">
                        <input type="text" id="launcherPath" name="launcherPath" class="cdx-text-input" value="@Model.LauncherPath" />
                        <button type="button" class="cdx-button cdx-button--primary" id="browseLauncherPath" data-title="@AppConfig.GetLocalized("FileBrowser:SelectExecutable", "Select Executable")">@AppConfig.GetLocalized("Common:Browse", "Browse")</button>
                    </div>
                    <p class="cdx-help-text" id="launcherPathNote">@AppConfig.GetLocalized("Settings:LauncherPathNote", "Select the executable file to launch the game.")</p>
                    <p class="cdx-help-text cdx-help-text--error" id="launcherPathError"></p>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-updates" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionUpdates", "Updates")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="autoCheckUpdates" name="autoCheckUpdates" @(Model.AutoCheckUpdates ? "checked" : "") onclick="toggleUpdateFrequency(this)" />
                        <label for="autoCheckUpdates" class="cdx-label">@AppConfig.GetLocalized("Updates:AutoCheckUpdates", "Automatically check for updates")</label>
                    </div>
                </div>
                <div class="cdx-field cdx-field--indented" id="updateFrequencySection">
                    <label for="updateFrequency" class="cdx-label">@AppConfig.GetLocalized("Updates:UpdateFrequencyLabel", "Check Frequency")</label>
                    <select id="updateFrequency" name="updateFrequency" class="cdx-select">
                        <option value="startup" selected="@(Model.UpdateFrequency == "startup")">@AppConfig.GetLocalized("Updates:FrequencyStartup", "On Startup")</option>
                        <option value="weekly" selected="@(Model.UpdateFrequency == "weekly")">@AppConfig.GetLocalized("Updates:FrequencyWeekly", "Weekly")</option>
                        <option value="monthly" selected="@(Model.UpdateFrequency == "monthly")">@AppConfig.GetLocalized("Updates:FrequencyMonthly", "Monthly")</option>
                    </select>
                </div>
                <div class="cdx-info-box">
                    <span class="cdx-info-box__text">@string.Format(AppConfig.GetLocalized("Updates:CurrentVersionInfo", "Current version: {0} {1}"), Model.ModName, Model.ModVersion)</span>
                </div>
                <div class="cdx-field cdx-field--indented">
                    <div class="cdx-button-group">
                        <button type="button" class="cdx-button cdx-button--primary cdx-button--small" id="checkNowButton">
                            @AppConfig.GetLocalized("Updates:CheckNowButton", "Check Now")
                        </button>
                        <button type="button" class="cdx-button cdx-button--safe cdx-button--small" id="downloadUpdateButton" style="display: none;">
                            @AppConfig.GetLocalized("Updates:DownloadButton", "Download")
                        </button>
                        <button type="button" class="cdx-button cdx-button--progressive cdx-button--small" id="applyUpdateButton" style="display: none;">
                            @AppConfig.GetLocalized("Updates:ApplyUpdateButton", "Apply")
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-notifications" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionNotifications", "Notifications")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="enableNotifications" name="enableNotifications" @(Model.EnableNotifications ? "checked" : "") onclick="toggleNotificationPermission(this)" />
                        <label for="enableNotifications" class="cdx-label">@AppConfig.GetLocalized("Notifications:EnableNotifications", "Enable browser notifications")</label>
                    </div>
                </div>
                <div class="cdx-field cdx-field--indented">
                    <div class="cdx-info-box cdx-info-box--muted">
                        <span class="cdx-info-box__text">@AppConfig.GetLocalized("Notifications:Description", "Receive notifications for updates and events")</span>
                    </div>
                    <div class="cdx-status-indicator" id="permissionStatus">
                        <span class="cdx-status-indicator__text" id="permissionStatusText">@AppConfig.GetLocalized("Notifications:CheckingPermission", "Checking...")</span>
                    </div>
                    <button type="button" class="cdx-button cdx-button--primary cdx-button--small" id="requestPermissionButton">
                        @AppConfig.GetLocalized("Notifications:RequestPermission", "Request Permission")
                    </button>
                </div>
            </div>
        </section>

        <section class="cdx-card">
            <header class="cdx-card-header">
                <h2 class="cdx-card-title">
                    <i data-icon="icon-title" class="cdx-icon" style="font-size: 1em;"></i>
                    @AppConfig.GetLocalized("Settings:SectionTitle", "Window Title")
                </h2>
            </header>
            <div class="cdx-card-body">
                <div class="cdx-field">
                    <div class="cdx-checkbox">
                        <input type="checkbox" id="modifyTitle" name="modifyTitle" @(Model.ModifyTitle ? "checked" : "") />
                        <label for="modifyTitle" class="cdx-label">@AppConfig.GetLocalized("Settings:ModifyTitleDescription", "Add 'Modded' prefix to game window title")</label>
                    </div>
                </div>
            </div>
        </section>

        <footer class="cdx-page-footer">
            <input type="hidden" id="showSecondsHidden" name="showSeconds" value="@Model.ShowSeconds.ToString().ToLower()" />
            <input type="hidden" id="use12HourHidden" name="use12Hour" value="@Model.Use12Hour.ToString().ToLower()" />
            <input type="hidden" id="dateFormatHidden" name="dateFormat" value="@Model.DateFormat" />
            <input type="hidden" id="launchModeHidden" value="@Model.LaunchMode" />
            <input type="hidden" id="localizedProhibitionText" value="@AppConfig.GetLocalized("Settings:ProhibitionText", "Cannot select the Mod Manager's own executable.")" />
            <input type="hidden" id="localizedUpdateAvailable" value="@AppConfig.GetLocalized("Updates:UpdateAvailable", "Update available: Version {0}")" />
            <input type="hidden" id="localizedNoReleaseNotes" value="@AppConfig.GetLocalized("Updates:NoReleaseNotes", "No release notes")" />
            <input type="hidden" id="localizedDownloadUpdate" value="@AppConfig.GetLocalized("Updates:DownloadUpdate", "Download")" />
            <input type="hidden" id="localizedNoUpdatesAvailable" value="@AppConfig.GetLocalized("Updates:NoUpdatesAvailable", "No updates available")" />
            <input type="hidden" id="localizedUpdateCheckingDisabled" value="@AppConfig.GetLocalized("Updates:UpdateCheckingDisabled", "Update checking is disabled")" />
            <input type="hidden" id="localizedUpdateCheckFailed" value="@AppConfig.GetLocalized("Updates:UpdateCheckFailed", "Update check failed")" />
            <input type="hidden" id="localizedNotificationNotSupported" value="@AppConfig.GetLocalized("Notifications:NotSupported", "Not supported")" />
            <input type="hidden" id="localizedNotificationPermissionGranted" value="@AppConfig.GetLocalized("Notifications:PermissionGranted", "Granted")" />
            <input type="hidden" id="localizedNotificationPermissionDenied" value="@AppConfig.GetLocalized("Notifications:PermissionDenied", "Denied")" />
            <input type="hidden" id="localizedNotificationPermissionDefault" value="@AppConfig.GetLocalized("Notifications:PermissionDefault", "Not granted")" />
            <input type="hidden" id="localizedNotificationRequestSuccess" value="@AppConfig.GetLocalized("Notifications:PermissionRequestSuccess", "Permission granted")" />
            <input type="hidden" id="localizedNotificationRequestDenied" value="@AppConfig.GetLocalized("Notifications:PermissionRequestDenied", "Permission denied")" />
            <input type="hidden" id="localizedNotificationRequestFailed" value="@AppConfig.GetLocalized("Notifications:PermissionRequestFailed", "Request failed")" />
            
            <button type="submit" class="cdx-button cdx-button--primary cdx-button--large" id="saveButton">
                <span class="cdx-button__icon cdx-button__icon--save"></span>
                @AppConfig.GetLocalized("Common:Save", "Save Changes")
            </button>
        </footer>
    </form>
</div>

<script src="~/js/settings.js"></script>

